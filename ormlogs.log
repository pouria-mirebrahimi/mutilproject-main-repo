[2023-01-10T07:34:12.466Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-10T07:34:16.987Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-10T07:34:17.282Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-10T07:34:17.543Z]3 migrations are already loaded in the database.
[2023-01-10T07:34:17.543Z]4 migrations were found in the source code.
[2023-01-10T07:34:17.592Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-10T07:34:17.592Z]1 migrations are new migrations must be executed.
[2023-01-10T07:34:17.593Z][QUERY]: BEGIN TRANSACTION
[2023-01-10T07:34:17.842Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int NOT NULL, "fromState" nvarchar(255) NOT NULL, "toState" nvarchar(255) NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-10T07:34:18.238Z][QUERY]: CREATE TABLE "instant_session" ("id" int NOT NULL IDENTITY(1,1), "keyStateLevelId" int NOT NULL, "subjectId" int NOT NULL, "description" nvarchar(255) NOT NULL, "duration" int NOT NULL, "status" nvarchar(255) NOT NULL, "cost" int NOT NULL, "studentId" int NOT NULL, "studentUserId" int NOT NULL, "tutorId" int NOT NULL, "tutorUserId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_236dff4a6fe22e15d9540dd20e7" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_15e5d41ba41cd671d89d1e5984b" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime NOT NULL, "keyStageLevelId" int, CONSTRAINT "PK_07fa3ec79f85982f9f115d7b9ba" PRIMARY KEY ("id"))
[2023-01-10T07:34:18.484Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-10T07:34:18.705Z][QUERY]: ALTER TABLE "key_stage_level" ADD "requestInstantId" int NOT NULL
[2023-01-10T07:34:19.133Z][FAILED QUERY]: ALTER TABLE "key_stage_level" ADD "requestInstantId" int NOT NULL
[2023-01-10T07:34:19.133Z][QUERY ERROR]: QueryFailedError: Error: ALTER TABLE only allows columns to be added that can contain nulls, or have a DEFAULT definition specified, or the column being added is an identity or timestamp column, or alternatively if none of the previous conditions are satisfied the table must be empty to allow addition of this column. Column 'requestInstantId' cannot be added to non-empty table 'key_stage_level' because it does not satisfy these conditions.
[2023-01-10T07:34:19.133Z]Migration "addInstantSession1673335952866" failed, error: Error: ALTER TABLE only allows columns to be added that can contain nulls, or have a DEFAULT definition specified, or the column being added is an identity or timestamp column, or alternatively if none of the previous conditions are satisfied the table must be empty to allow addition of this column. Column 'requestInstantId' cannot be added to non-empty table 'key_stage_level' because it does not satisfy these conditions.
[2023-01-10T07:49:55.893Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-10T07:50:00.086Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-10T07:50:00.356Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-10T07:50:00.602Z]3 migrations are already loaded in the database.
[2023-01-10T07:50:00.603Z]4 migrations were found in the source code.
[2023-01-10T07:50:00.603Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-10T07:50:00.603Z]1 migrations are new migrations must be executed.
[2023-01-10T07:50:00.604Z][QUERY]: BEGIN TRANSACTION
[2023-01-10T07:50:00.849Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int NOT NULL, "fromState" nvarchar(255) NOT NULL, "toState" nvarchar(255) NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-10T07:50:00.980Z][QUERY]: CREATE TABLE "instant_session" ("id" int NOT NULL IDENTITY(1,1), "keyStateLevelId" int NOT NULL, "subjectId" int NOT NULL, "description" nvarchar(255), "duration" int NOT NULL, "status" nvarchar(255) NOT NULL CONSTRAINT "DF_1bfbc51bd247a3cdabae2a5744a" DEFAULT 'PENDING', "cost" int NOT NULL, "studentId" int NOT NULL, "studentUserId" int NOT NULL, "tutorId" int NOT NULL, "tutorUserId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_236dff4a6fe22e15d9540dd20e7" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_15e5d41ba41cd671d89d1e5984b" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, "keyStageLevelId" int, CONSTRAINT "PK_07fa3ec79f85982f9f115d7b9ba" PRIMARY KEY ("id"))
[2023-01-10T07:50:01.117Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-10T07:50:01.243Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "instant_session"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-10T07:50:01.565Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-10T07:50:01.690Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_72f2e00b62114d054c665a8c368" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-10T07:50:01.818Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-10T07:50:01.967Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_f6b47133af0a287228d64248984" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-10T07:50:02.100Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673336958013,"type":"bigint","params":[]},{"value":"addInstantSession1673336958013","type":"varchar","params":[]}]
[2023-01-10T07:50:02.231Z]Migration addInstantSession1673336958013 has been executed successfully.
[2023-01-10T07:50:02.355Z][QUERY]: COMMIT
[2023-01-10T16:55:37.668Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-10T16:55:45.028Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-10T16:55:45.355Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-10T16:55:45.663Z]4 migrations are already loaded in the database.
[2023-01-10T16:55:45.664Z]addInstantSession1673336958013 is the last executed migration. It was executed on Tue Jan 10 2023 07:49:18 GMT+0000 (Coordinated Universal Time).
[2023-01-10T16:55:45.664Z]Now reverting it...
[2023-01-10T16:55:45.665Z][QUERY]: BEGIN TRANSACTION
[2023-01-10T16:55:45.956Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_f6b47133af0a287228d64248984"
[2023-01-10T16:55:46.310Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc"
[2023-01-10T16:55:46.466Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_72f2e00b62114d054c665a8c368"
[2023-01-10T16:55:46.621Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23"
[2023-01-10T16:55:46.781Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-10T16:55:46.997Z][QUERY]: DROP TABLE "template"
[2023-01-10T16:55:47.191Z][QUERY]: DROP TABLE "instant_session"
[2023-01-10T16:55:47.327Z][QUERY]: DROP TABLE "status_log"
[2023-01-10T16:55:47.476Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673336958013,"type":"bigint","params":[]},{"value":"addInstantSession1673336958013","type":"varchar","params":[]}]
[2023-01-10T16:55:47.643Z]Migration addInstantSession1673336958013 has been reverted successfully.
[2023-01-10T16:55:47.940Z][QUERY]: COMMIT
[2023-01-10T18:45:16.494Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-10T18:45:21.593Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-10T18:45:21.889Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-10T18:45:22.248Z]3 migrations are already loaded in the database.
[2023-01-10T18:45:22.248Z]4 migrations were found in the source code.
[2023-01-10T18:45:22.248Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-10T18:45:22.248Z]1 migrations are new migrations must be executed.
[2023-01-10T18:45:22.249Z][QUERY]: BEGIN TRANSACTION
[2023-01-10T18:45:22.559Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int NOT NULL, "fromState" int NOT NULL, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-10T18:45:22.719Z][QUERY]: CREATE TABLE "instant_session" ("id" int NOT NULL IDENTITY(1,1), "keyStageLevelId" int NOT NULL, "subjectId" int NOT NULL, "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_1bfbc51bd247a3cdabae2a5744a" DEFAULT 0, "cost" int NOT NULL, "studentId" int NOT NULL, "studentUserId" int NOT NULL, "tutorId" int NOT NULL, "tutorUserId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_236dff4a6fe22e15d9540dd20e7" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_15e5d41ba41cd671d89d1e5984b" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, CONSTRAINT "PK_07fa3ec79f85982f9f115d7b9ba" PRIMARY KEY ("id"))
[2023-01-10T18:45:22.880Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-10T18:45:23.079Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "instant_session"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-10T18:45:23.239Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-10T18:45:23.401Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_72f2e00b62114d054c665a8c368" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-10T18:45:23.567Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-10T18:45:23.701Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_f6b47133af0a287228d64248984" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-10T18:45:23.849Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673376272626,"type":"bigint","params":[]},{"value":"addInstantSession1673376272626","type":"varchar","params":[]}]
[2023-01-10T18:45:24.000Z]Migration addInstantSession1673376272626 has been executed successfully.
[2023-01-10T18:45:24.161Z][QUERY]: COMMIT
[2023-01-10T20:02:48.136Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-10T20:02:54.054Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-10T20:02:54.387Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-10T20:02:54.741Z]4 migrations are already loaded in the database.
[2023-01-10T20:02:54.742Z]addInstantSession1673376272626 is the last executed migration. It was executed on Tue Jan 10 2023 18:44:32 GMT+0000 (Coordinated Universal Time).
[2023-01-10T20:02:54.742Z]Now reverting it...
[2023-01-10T20:02:54.744Z][QUERY]: BEGIN TRANSACTION
[2023-01-10T20:02:55.046Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_f6b47133af0a287228d64248984"
[2023-01-10T20:02:55.201Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc"
[2023-01-10T20:02:55.348Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_72f2e00b62114d054c665a8c368"
[2023-01-10T20:02:55.492Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23"
[2023-01-10T20:02:55.639Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-10T20:02:55.805Z][QUERY]: DROP TABLE "template"
[2023-01-10T20:02:55.964Z][QUERY]: DROP TABLE "instant_session"
[2023-01-10T20:02:56.123Z][QUERY]: DROP TABLE "status_log"
[2023-01-10T20:02:56.286Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673376272626,"type":"bigint","params":[]},{"value":"addInstantSession1673376272626","type":"varchar","params":[]}]
[2023-01-10T20:02:56.445Z]Migration addInstantSession1673376272626 has been reverted successfully.
[2023-01-10T20:02:56.601Z][QUERY]: COMMIT
[2023-01-10T20:03:57.895Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-10T20:04:02.312Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-10T20:04:02.604Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-10T20:04:02.925Z]3 migrations are already loaded in the database.
[2023-01-10T20:04:02.925Z]4 migrations were found in the source code.
[2023-01-10T20:04:02.926Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-10T20:04:02.926Z]1 migrations are new migrations must be executed.
[2023-01-10T20:04:02.927Z][QUERY]: BEGIN TRANSACTION
[2023-01-10T20:04:03.194Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int NOT NULL, "fromState" int NOT NULL, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-10T20:04:03.334Z][QUERY]: CREATE TABLE "instant_session" ("id" int NOT NULL IDENTITY(1,1), "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_1bfbc51bd247a3cdabae2a5744a" DEFAULT 0, "cost" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_236dff4a6fe22e15d9540dd20e7" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_15e5d41ba41cd671d89d1e5984b" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, "keyStageLevelId" int, "subjectId" int, "studentId" int, "tutorId" int, CONSTRAINT "PK_07fa3ec79f85982f9f115d7b9ba" PRIMARY KEY ("id"))
[2023-01-10T20:04:03.493Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-10T20:04:03.702Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "instant_session"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-10T20:04:03.848Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-10T20:04:04.010Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_72f2e00b62114d054c665a8c368" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-10T20:04:04.164Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-10T20:04:04.300Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_f6b47133af0a287228d64248984" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-10T20:04:04.440Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673381002565,"type":"bigint","params":[]},{"value":"addInstantSession1673381002565","type":"varchar","params":[]}]
[2023-01-10T20:04:04.598Z]Migration addInstantSession1673381002565 has been executed successfully.
[2023-01-10T20:04:04.766Z][QUERY]: COMMIT
[2023-01-11T07:16:14.158Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-11T07:16:19.066Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-11T07:16:19.544Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-11T07:16:20.034Z]4 migrations are already loaded in the database.
[2023-01-11T07:16:20.034Z]addInstantSession1673381002565 is the last executed migration. It was executed on Tue Jan 10 2023 20:03:22 GMT+0000 (Coordinated Universal Time).
[2023-01-11T07:16:20.034Z]Now reverting it...
[2023-01-11T07:16:20.035Z][QUERY]: BEGIN TRANSACTION
[2023-01-11T07:16:20.590Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_f6b47133af0a287228d64248984"
[2023-01-11T07:16:20.789Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc"
[2023-01-11T07:16:20.955Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_72f2e00b62114d054c665a8c368"
[2023-01-11T07:16:21.117Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23"
[2023-01-11T07:16:21.311Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-11T07:16:21.510Z][QUERY]: DROP TABLE "template"
[2023-01-11T07:16:21.709Z][QUERY]: DROP TABLE "instant_session"
[2023-01-11T07:16:21.872Z][QUERY]: DROP TABLE "status_log"
[2023-01-11T07:16:22.048Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673381002565,"type":"bigint","params":[]},{"value":"addInstantSession1673381002565","type":"varchar","params":[]}]
[2023-01-11T07:16:22.268Z]Migration addInstantSession1673381002565 has been reverted successfully.
[2023-01-11T07:16:22.435Z][QUERY]: COMMIT
[2023-01-11T07:17:17.276Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-11T07:17:22.001Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-11T07:17:22.379Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-11T07:17:22.797Z]3 migrations are already loaded in the database.
[2023-01-11T07:17:22.797Z]4 migrations were found in the source code.
[2023-01-11T07:17:22.798Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-11T07:17:22.798Z]1 migrations are new migrations must be executed.
[2023-01-11T07:17:22.799Z][QUERY]: BEGIN TRANSACTION
[2023-01-11T07:17:23.154Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int NOT NULL, "fromState" int NOT NULL, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-11T07:17:23.349Z][QUERY]: CREATE TABLE "instant_session" ("id" int NOT NULL IDENTITY(1,1), "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_1bfbc51bd247a3cdabae2a5744a" DEFAULT 0, "cost" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_236dff4a6fe22e15d9540dd20e7" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_15e5d41ba41cd671d89d1e5984b" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, "keyStageLevelId" int, "subjectId" int, "studentId" int, "tutorId" int, CONSTRAINT "PK_07fa3ec79f85982f9f115d7b9ba" PRIMARY KEY ("id"))
[2023-01-11T07:17:23.525Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-11T07:17:23.709Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "instant_session"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-11T07:17:23.912Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-11T07:17:24.084Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_72f2e00b62114d054c665a8c368" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-11T07:17:24.310Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-11T07:17:24.484Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_f6b47133af0a287228d64248984" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-11T07:17:24.680Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673421404024,"type":"bigint","params":[]},{"value":"addInstantSession1673421404024","type":"varchar","params":[]}]
[2023-01-11T07:17:24.948Z]Migration addInstantSession1673421404024 has been executed successfully.
[2023-01-11T07:17:25.149Z][QUERY]: COMMIT
[2023-01-12T09:20:54.372Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T09:20:58.781Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T09:20:59.174Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T09:20:59.510Z]4 migrations are already loaded in the database.
[2023-01-12T09:20:59.511Z]addInstantSession1673421404024 is the last executed migration. It was executed on Wed Jan 11 2023 07:16:44 GMT+0000 (Coordinated Universal Time).
[2023-01-12T09:20:59.511Z]Now reverting it...
[2023-01-12T09:20:59.514Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T09:20:59.838Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_f6b47133af0a287228d64248984"
[2023-01-12T09:21:00.021Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc"
[2023-01-12T09:21:00.185Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_72f2e00b62114d054c665a8c368"
[2023-01-12T09:21:00.379Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23"
[2023-01-12T09:21:00.558Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-12T09:21:00.719Z][QUERY]: DROP TABLE "template"
[2023-01-12T09:21:00.882Z][QUERY]: DROP TABLE "instant_session"
[2023-01-12T09:21:01.046Z][QUERY]: DROP TABLE "status_log"
[2023-01-12T09:21:01.213Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673421404024,"type":"bigint","params":[]},{"value":"addInstantSession1673421404024","type":"varchar","params":[]}]
[2023-01-12T09:21:01.386Z]Migration addInstantSession1673421404024 has been reverted successfully.
[2023-01-12T09:21:01.554Z][QUERY]: COMMIT
[2023-01-12T09:22:11.756Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T09:22:16.343Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T09:22:16.685Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T09:22:16.993Z]3 migrations are already loaded in the database.
[2023-01-12T09:22:16.994Z]4 migrations were found in the source code.
[2023-01-12T09:22:16.994Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-12T09:22:16.994Z]1 migrations are new migrations must be executed.
[2023-01-12T09:22:16.995Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T09:22:17.346Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int NOT NULL, "fromState" int NOT NULL, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-12T09:22:17.528Z][QUERY]: CREATE TABLE "instant_session" ("id" int NOT NULL IDENTITY(1,1), "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_1bfbc51bd247a3cdabae2a5744a" DEFAULT 0, "cost" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_236dff4a6fe22e15d9540dd20e7" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_15e5d41ba41cd671d89d1e5984b" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, "keyStageLevelId" int, "subjectId" int, "studentId" int, "tutorId" int, CONSTRAINT "PK_07fa3ec79f85982f9f115d7b9ba" PRIMARY KEY ("id"))
[2023-01-12T09:22:17.690Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-12T09:22:17.854Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "instant_session"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T09:22:18.025Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T09:22:18.188Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_72f2e00b62114d054c665a8c368" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T09:22:18.357Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T09:22:18.517Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_f6b47133af0a287228d64248984" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T09:22:18.692Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673515276201,"type":"bigint","params":[]},{"value":"addInstantSession1673515276201","type":"varchar","params":[]}]
[2023-01-12T09:22:18.860Z]Migration addInstantSession1673515276201 has been executed successfully.
[2023-01-12T09:22:19.029Z][QUERY]: COMMIT
[2023-01-12T12:53:45.290Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T12:54:58.557Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T12:57:06.673Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T12:57:11.875Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T12:57:12.280Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T12:57:12.671Z]4 migrations are already loaded in the database.
[2023-01-12T12:57:12.672Z]addInstantSession1673515276201 is the last executed migration. It was executed on Thu Jan 12 2023 09:21:16 GMT+0000 (Coordinated Universal Time).
[2023-01-12T12:57:12.672Z]Now reverting it...
[2023-01-12T12:57:12.673Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T12:57:13.033Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_f6b47133af0a287228d64248984"
[2023-01-12T12:57:13.230Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc"
[2023-01-12T12:57:13.508Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_72f2e00b62114d054c665a8c368"
[2023-01-12T12:57:13.709Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23"
[2023-01-12T12:57:13.908Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-12T12:57:14.112Z][QUERY]: DROP TABLE "template"
[2023-01-12T12:57:14.307Z][QUERY]: DROP TABLE "instant_session"
[2023-01-12T12:57:14.507Z][QUERY]: DROP TABLE "status_log"
[2023-01-12T12:57:14.703Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673515276201,"type":"bigint","params":[]},{"value":"addInstantSession1673515276201","type":"varchar","params":[]}]
[2023-01-12T12:57:14.889Z]Migration addInstantSession1673515276201 has been reverted successfully.
[2023-01-12T12:57:15.063Z][QUERY]: COMMIT
[2023-01-12T13:03:53.769Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T13:03:58.707Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T13:03:59.078Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T13:03:59.440Z]3 migrations are already loaded in the database.
[2023-01-12T13:03:59.440Z]4 migrations were found in the source code.
[2023-01-12T13:03:59.441Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-12T13:03:59.441Z]1 migrations are new migrations must be executed.
[2023-01-12T13:03:59.442Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T13:03:59.795Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" nvarchar(255) NOT NULL, "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), "tutorId" int, CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-12T13:03:59.999Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int NOT NULL, "fromState" int NOT NULL, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), "lessonId" int, CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-12T13:04:00.189Z][QUERY]: CREATE TABLE "instant_session" ("id" int NOT NULL IDENTITY(1,1), "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_1bfbc51bd247a3cdabae2a5744a" DEFAULT 10, "cost" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_236dff4a6fe22e15d9540dd20e7" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_15e5d41ba41cd671d89d1e5984b" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, "keyStageLevelId" int, "subjectId" int, "studentId" int, "tutorId" int, CONSTRAINT "PK_07fa3ec79f85982f9f115d7b9ba" PRIMARY KEY ("id"))
[2023-01-12T13:04:00.387Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-12T13:04:00.596Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T13:04:00.783Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "instant_session"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T13:04:00.986Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T13:04:01.186Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T13:04:01.374Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_72f2e00b62114d054c665a8c368" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T13:04:01.547Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T13:04:01.746Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_f6b47133af0a287228d64248984" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T13:04:01.956Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673528279834,"type":"bigint","params":[]},{"value":"addLessonTable1673528279834","type":"varchar","params":[]}]
[2023-01-12T13:04:02.146Z]Migration addLessonTable1673528279834 has been executed successfully.
[2023-01-12T13:04:02.395Z][QUERY]: COMMIT
[2023-01-12T18:00:08.322Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T18:00:13.980Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T18:00:14.364Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T18:00:14.701Z]4 migrations are already loaded in the database.
[2023-01-12T18:00:14.701Z]addLessonTable1673528279834 is the last executed migration. It was executed on Thu Jan 12 2023 12:57:59 GMT+0000 (Coordinated Universal Time).
[2023-01-12T18:00:14.702Z]Now reverting it...
[2023-01-12T18:00:14.704Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T18:00:15.041Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_f6b47133af0a287228d64248984"
[2023-01-12T18:00:15.210Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc"
[2023-01-12T18:00:15.388Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_72f2e00b62114d054c665a8c368"
[2023-01-12T18:00:15.572Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23"
[2023-01-12T18:00:16.087Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_77b3f1846ed47c723c8525ca223"
[2023-01-12T18:00:16.257Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-12T18:00:16.432Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_73366372b46c005d3c1e472a3f8"
[2023-01-12T18:00:16.598Z][QUERY]: DROP TABLE "template"
[2023-01-12T18:00:16.779Z][QUERY]: DROP TABLE "instant_session"
[2023-01-12T18:00:16.954Z][QUERY]: DROP TABLE "status_log"
[2023-01-12T18:00:17.119Z][QUERY]: DROP TABLE "lesson"
[2023-01-12T18:00:17.300Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673528279834,"type":"bigint","params":[]},{"value":"addLessonTable1673528279834","type":"varchar","params":[]}]
[2023-01-12T18:00:17.471Z]Migration addLessonTable1673528279834 has been reverted successfully.
[2023-01-12T18:00:17.675Z][QUERY]: COMMIT
[2023-01-12T18:03:37.441Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T18:03:42.110Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T18:03:42.686Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T18:03:43.040Z]3 migrations are already loaded in the database.
[2023-01-12T18:03:43.040Z]4 migrations were found in the source code.
[2023-01-12T18:03:43.041Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-12T18:03:43.041Z]1 migrations are new migrations must be executed.
[2023-01-12T18:03:43.042Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T18:03:43.387Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" nvarchar(255) NOT NULL, "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), "tutorId" int, CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-12T18:03:43.593Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int NOT NULL, "fromState" int NOT NULL, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), "lessonId" int, CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-12T18:03:43.757Z][QUERY]: CREATE TABLE "instant_session" ("id" int NOT NULL IDENTITY(1,1), "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_1bfbc51bd247a3cdabae2a5744a" DEFAULT 10, "cost" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_236dff4a6fe22e15d9540dd20e7" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_15e5d41ba41cd671d89d1e5984b" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, "keyStageLevelId" int, "subjectId" int, "studentId" int, "tutorId" int, CONSTRAINT "PK_07fa3ec79f85982f9f115d7b9ba" PRIMARY KEY ("id"))
[2023-01-12T18:03:43.956Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-12T18:03:44.153Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:03:44.317Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "instant_session"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:03:44.511Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:03:44.675Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:03:44.835Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_72f2e00b62114d054c665a8c368" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:03:44.995Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:03:45.155Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_f6b47133af0a287228d64248984" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:03:45.320Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673546585904,"type":"bigint","params":[]},{"value":"addLessonTable1673546585904","type":"varchar","params":[]}]
[2023-01-12T18:03:45.508Z]Migration addLessonTable1673546585904 has been executed successfully.
[2023-01-12T18:03:45.689Z][QUERY]: COMMIT
[2023-01-12T18:06:55.194Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T18:07:00.173Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T18:07:00.512Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T18:07:00.877Z]4 migrations are already loaded in the database.
[2023-01-12T18:07:00.878Z]addLessonTable1673546585904 is the last executed migration. It was executed on Thu Jan 12 2023 18:03:05 GMT+0000 (Coordinated Universal Time).
[2023-01-12T18:07:00.878Z]Now reverting it...
[2023-01-12T18:07:00.879Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T18:07:01.226Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_f6b47133af0a287228d64248984"
[2023-01-12T18:07:01.392Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc"
[2023-01-12T18:07:01.558Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_72f2e00b62114d054c665a8c368"
[2023-01-12T18:07:01.752Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23"
[2023-01-12T18:07:01.914Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_77b3f1846ed47c723c8525ca223"
[2023-01-12T18:07:02.084Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-12T18:07:02.246Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_73366372b46c005d3c1e472a3f8"
[2023-01-12T18:07:02.437Z][QUERY]: DROP TABLE "template"
[2023-01-12T18:07:02.607Z][QUERY]: DROP TABLE "instant_session"
[2023-01-12T18:07:02.792Z][QUERY]: DROP TABLE "status_log"
[2023-01-12T18:07:02.955Z][QUERY]: DROP TABLE "lesson"
[2023-01-12T18:07:03.149Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673546585904,"type":"bigint","params":[]},{"value":"addLessonTable1673546585904","type":"varchar","params":[]}]
[2023-01-12T18:07:03.316Z]Migration addLessonTable1673546585904 has been reverted successfully.
[2023-01-12T18:07:03.513Z][QUERY]: COMMIT
[2023-01-12T18:07:44.400Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T18:07:49.009Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T18:07:49.363Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T18:07:49.718Z]3 migrations are already loaded in the database.
[2023-01-12T18:07:49.718Z]4 migrations were found in the source code.
[2023-01-12T18:07:49.719Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-12T18:07:49.719Z]1 migrations are new migrations must be executed.
[2023-01-12T18:07:49.720Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T18:07:50.073Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" nvarchar(255) NOT NULL, "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), "tutorId" int, CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-12T18:07:50.272Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int NOT NULL, "fromState" int NOT NULL, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), "lessonId" int, CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-12T18:07:50.473Z][QUERY]: CREATE TABLE "instant_session" ("id" int NOT NULL IDENTITY(1,1), "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_1bfbc51bd247a3cdabae2a5744a" DEFAULT 10, "cost" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_236dff4a6fe22e15d9540dd20e7" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_15e5d41ba41cd671d89d1e5984b" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, "keyStageLevelId" int, "subjectId" int, "studentId" int, "tutorId" int, CONSTRAINT "PK_07fa3ec79f85982f9f115d7b9ba" PRIMARY KEY ("id"))
[2023-01-12T18:07:50.679Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-12T18:07:50.872Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:07:51.036Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "instant_session"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:07:51.232Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:07:51.396Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:07:51.565Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_72f2e00b62114d054c665a8c368" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:07:51.751Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:07:51.913Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_f6b47133af0a287228d64248984" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:07:52.079Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673546835171,"type":"bigint","params":[]},{"value":"addLessonTable1673546835171","type":"varchar","params":[]}]
[2023-01-12T18:07:52.253Z]Migration addLessonTable1673546835171 has been executed successfully.
[2023-01-12T18:07:52.430Z][QUERY]: COMMIT
[2023-01-12T18:42:10.132Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T18:42:16.639Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T18:42:16.995Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T18:42:17.365Z]4 migrations are already loaded in the database.
[2023-01-12T18:42:17.365Z]addLessonTable1673546835171 is the last executed migration. It was executed on Thu Jan 12 2023 18:07:15 GMT+0000 (Coordinated Universal Time).
[2023-01-12T18:42:17.365Z]Now reverting it...
[2023-01-12T18:42:17.366Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T18:42:17.723Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_f6b47133af0a287228d64248984"
[2023-01-12T18:42:17.886Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc"
[2023-01-12T18:42:18.083Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_72f2e00b62114d054c665a8c368"
[2023-01-12T18:42:18.246Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23"
[2023-01-12T18:42:18.439Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_77b3f1846ed47c723c8525ca223"
[2023-01-12T18:42:18.977Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-12T18:42:19.160Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_73366372b46c005d3c1e472a3f8"
[2023-01-12T18:42:19.357Z][QUERY]: DROP TABLE "template"
[2023-01-12T18:42:19.540Z][QUERY]: DROP TABLE "instant_session"
[2023-01-12T18:42:19.728Z][QUERY]: DROP TABLE "status_log"
[2023-01-12T18:42:19.957Z][QUERY]: DROP TABLE "lesson"
[2023-01-12T18:42:20.145Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673546835171,"type":"bigint","params":[]},{"value":"addLessonTable1673546835171","type":"varchar","params":[]}]
[2023-01-12T18:42:20.323Z]Migration addLessonTable1673546835171 has been reverted successfully.
[2023-01-12T18:42:20.482Z][QUERY]: COMMIT
[2023-01-12T18:43:05.618Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T18:43:10.389Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T18:43:10.827Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T18:43:11.246Z]3 migrations are already loaded in the database.
[2023-01-12T18:43:11.246Z]4 migrations were found in the source code.
[2023-01-12T18:43:11.246Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-12T18:43:11.247Z]1 migrations are new migrations must be executed.
[2023-01-12T18:43:11.248Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T18:43:11.601Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" nvarchar(255) NOT NULL, "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), "instantSessionRequestId" int, "tutorId" int, CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-12T18:43:11.782Z][QUERY]: CREATE UNIQUE INDEX "REL_242806c795d4385be9d7fafc50" ON "lesson" ("instantSessionRequestId") WHERE "instantSessionRequestId" IS NOT NULL
[2023-01-12T18:43:11.960Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int NOT NULL, "fromState" int NOT NULL, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), "lessonId" int, CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-12T18:43:12.124Z][QUERY]: CREATE TABLE "instant_session" ("id" int NOT NULL IDENTITY(1,1), "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_1bfbc51bd247a3cdabae2a5744a" DEFAULT 10, "cost" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_236dff4a6fe22e15d9540dd20e7" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_15e5d41ba41cd671d89d1e5984b" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, "keyStageLevelId" int, "subjectId" int, "studentId" int, "tutorId" int, CONSTRAINT "PK_07fa3ec79f85982f9f115d7b9ba" PRIMARY KEY ("id"))
[2023-01-12T18:43:12.314Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-12T18:43:12.502Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_242806c795d4385be9d7fafc50a" FOREIGN KEY ("instantSessionRequestId") REFERENCES "instant_session"("id") ON DELETE CASCADE ON UPDATE NO ACTION
[2023-01-12T18:43:12.668Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:43:12.844Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "instant_session"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:43:13.018Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:43:13.201Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:43:13.365Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_72f2e00b62114d054c665a8c368" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:43:13.524Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:43:13.686Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_f6b47133af0a287228d64248984" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:43:13.869Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673548957378,"type":"bigint","params":[]},{"value":"addLessonTable1673548957378","type":"varchar","params":[]}]
[2023-01-12T18:43:14.035Z]Migration addLessonTable1673548957378 has been executed successfully.
[2023-01-12T18:43:14.211Z][QUERY]: COMMIT
[2023-01-12T18:58:00.873Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T18:58:05.421Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T18:58:05.759Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T18:58:06.086Z]4 migrations are already loaded in the database.
[2023-01-12T18:58:06.086Z]addLessonTable1673548957378 is the last executed migration. It was executed on Thu Jan 12 2023 18:42:37 GMT+0000 (Coordinated Universal Time).
[2023-01-12T18:58:06.087Z]Now reverting it...
[2023-01-12T18:58:06.087Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T18:58:06.428Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_f6b47133af0a287228d64248984"
[2023-01-12T18:58:06.598Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc"
[2023-01-12T18:58:06.769Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_72f2e00b62114d054c665a8c368"
[2023-01-12T18:58:06.942Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23"
[2023-01-12T18:58:07.143Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_77b3f1846ed47c723c8525ca223"
[2023-01-12T18:58:07.306Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-12T18:58:07.467Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_73366372b46c005d3c1e472a3f8"
[2023-01-12T18:58:07.626Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_242806c795d4385be9d7fafc50a"
[2023-01-12T18:58:07.787Z][QUERY]: DROP TABLE "template"
[2023-01-12T18:58:07.947Z][QUERY]: DROP TABLE "instant_session"
[2023-01-12T18:58:08.106Z][QUERY]: DROP TABLE "status_log"
[2023-01-12T18:58:08.270Z][QUERY]: DROP INDEX "REL_242806c795d4385be9d7fafc50" ON "lesson"
[2023-01-12T18:58:08.472Z][QUERY]: DROP TABLE "lesson"
[2023-01-12T18:58:08.678Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673548957378,"type":"bigint","params":[]},{"value":"addLessonTable1673548957378","type":"varchar","params":[]}]
[2023-01-12T18:58:08.863Z]Migration addLessonTable1673548957378 has been reverted successfully.
[2023-01-12T18:58:09.031Z][QUERY]: COMMIT
[2023-01-12T18:59:07.159Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T18:59:11.969Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T18:59:12.325Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T18:59:12.669Z]3 migrations are already loaded in the database.
[2023-01-12T18:59:12.669Z]4 migrations were found in the source code.
[2023-01-12T18:59:12.669Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-12T18:59:12.669Z]1 migrations are new migrations must be executed.
[2023-01-12T18:59:12.670Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T18:59:12.987Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" nvarchar(255) NOT NULL, "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), "instantSessionRequestId" int, "tutorId" int, CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-12T18:59:13.184Z][QUERY]: CREATE UNIQUE INDEX "REL_242806c795d4385be9d7fafc50" ON "lesson" ("instantSessionRequestId") WHERE "instantSessionRequestId" IS NOT NULL
[2023-01-12T18:59:13.349Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int NOT NULL, "fromState" int NOT NULL, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), "lessonId" int, CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-12T18:59:13.520Z][QUERY]: CREATE TABLE "instant_session" ("id" int NOT NULL IDENTITY(1,1), "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_1bfbc51bd247a3cdabae2a5744a" DEFAULT 10, "cost" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_236dff4a6fe22e15d9540dd20e7" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_15e5d41ba41cd671d89d1e5984b" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, "keyStageLevelId" int, "subjectId" int, "studentId" int, "tutorId" int, CONSTRAINT "PK_07fa3ec79f85982f9f115d7b9ba" PRIMARY KEY ("id"))
[2023-01-12T18:59:13.700Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-12T18:59:13.873Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_242806c795d4385be9d7fafc50a" FOREIGN KEY ("instantSessionRequestId") REFERENCES "instant_session"("id") ON DELETE CASCADE ON UPDATE NO ACTION
[2023-01-12T18:59:14.057Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:59:14.217Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "instant_session"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:59:14.376Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:59:14.545Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:59:14.708Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_72f2e00b62114d054c665a8c368" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:59:14.869Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:59:15.029Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_f6b47133af0a287228d64248984" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T18:59:15.199Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673549905498,"type":"bigint","params":[]},{"value":"addLessonTable1673549905498","type":"varchar","params":[]}]
[2023-01-12T18:59:15.380Z]Migration addLessonTable1673549905498 has been executed successfully.
[2023-01-12T18:59:15.546Z][QUERY]: COMMIT
[2023-01-12T19:13:08.944Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T19:13:13.809Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T19:13:14.169Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T19:13:14.531Z]4 migrations are already loaded in the database.
[2023-01-12T19:13:14.531Z]addLessonTable1673549905498 is the last executed migration. It was executed on Thu Jan 12 2023 18:58:25 GMT+0000 (Coordinated Universal Time).
[2023-01-12T19:13:14.531Z]Now reverting it...
[2023-01-12T19:13:14.532Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T19:13:14.882Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_f6b47133af0a287228d64248984"
[2023-01-12T19:13:15.054Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc"
[2023-01-12T19:13:15.219Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_72f2e00b62114d054c665a8c368"
[2023-01-12T19:13:15.408Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23"
[2023-01-12T19:13:15.577Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_77b3f1846ed47c723c8525ca223"
[2023-01-12T19:13:15.777Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-12T19:13:15.946Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_73366372b46c005d3c1e472a3f8"
[2023-01-12T19:13:16.107Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_242806c795d4385be9d7fafc50a"
[2023-01-12T19:13:16.284Z][QUERY]: DROP TABLE "template"
[2023-01-12T19:13:16.480Z][QUERY]: DROP TABLE "instant_session"
[2023-01-12T19:13:16.647Z][QUERY]: DROP TABLE "status_log"
[2023-01-12T19:13:16.804Z][QUERY]: DROP INDEX "REL_242806c795d4385be9d7fafc50" ON "lesson"
[2023-01-12T19:13:16.965Z][QUERY]: DROP TABLE "lesson"
[2023-01-12T19:13:17.134Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673549905498,"type":"bigint","params":[]},{"value":"addLessonTable1673549905498","type":"varchar","params":[]}]
[2023-01-12T19:13:17.321Z]Migration addLessonTable1673549905498 has been reverted successfully.
[2023-01-12T19:13:17.484Z][QUERY]: COMMIT
[2023-01-12T19:14:08.849Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T19:14:13.535Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T19:14:13.879Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T19:14:14.227Z]3 migrations are already loaded in the database.
[2023-01-12T19:14:14.227Z]4 migrations were found in the source code.
[2023-01-12T19:14:14.227Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-12T19:14:14.227Z]1 migrations are new migrations must be executed.
[2023-01-12T19:14:14.228Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T19:14:14.546Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" nvarchar(255) NOT NULL, "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), "instantSessionRequestId" int, "tutorId" int, CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-12T19:14:14.725Z][QUERY]: CREATE UNIQUE INDEX "REL_242806c795d4385be9d7fafc50" ON "lesson" ("instantSessionRequestId") WHERE "instantSessionRequestId" IS NOT NULL
[2023-01-12T19:14:15.069Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int NOT NULL, "fromState" int NOT NULL, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), "lessonId" int, CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-12T19:14:15.237Z][QUERY]: CREATE TABLE "instant_session" ("id" int NOT NULL IDENTITY(1,1), "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_1bfbc51bd247a3cdabae2a5744a" DEFAULT 10, "cost" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_236dff4a6fe22e15d9540dd20e7" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_15e5d41ba41cd671d89d1e5984b" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, "keyStageLevelId" int, "subjectId" int, "studentId" int, "tutorId" int, CONSTRAINT "PK_07fa3ec79f85982f9f115d7b9ba" PRIMARY KEY ("id"))
[2023-01-12T19:14:15.441Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-12T19:14:15.608Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_242806c795d4385be9d7fafc50a" FOREIGN KEY ("instantSessionRequestId") REFERENCES "instant_session"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T19:14:15.800Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T19:14:15.965Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "instant_session"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T19:14:16.188Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T19:14:16.364Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T19:14:16.532Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_72f2e00b62114d054c665a8c368" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T19:14:16.720Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T19:14:16.888Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_f6b47133af0a287228d64248984" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T19:14:17.066Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673550819110,"type":"bigint","params":[]},{"value":"addLessonTable1673550819110","type":"varchar","params":[]}]
[2023-01-12T19:14:17.233Z]Migration addLessonTable1673550819110 has been executed successfully.
[2023-01-12T19:14:17.395Z][QUERY]: COMMIT
[2023-01-12T20:51:45.661Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T20:51:50.159Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T20:51:50.536Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T20:51:50.852Z]4 migrations are already loaded in the database.
[2023-01-12T20:51:50.852Z]addLessonTable1673550819110 is the last executed migration. It was executed on Thu Jan 12 2023 19:13:39 GMT+0000 (Coordinated Universal Time).
[2023-01-12T20:51:50.852Z]Now reverting it...
[2023-01-12T20:51:50.853Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T20:51:51.168Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_f6b47133af0a287228d64248984"
[2023-01-12T20:51:51.335Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc"
[2023-01-12T20:51:51.495Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_72f2e00b62114d054c665a8c368"
[2023-01-12T20:51:51.692Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23"
[2023-01-12T20:51:51.882Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_77b3f1846ed47c723c8525ca223"
[2023-01-12T20:51:52.049Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-12T20:51:52.209Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_73366372b46c005d3c1e472a3f8"
[2023-01-12T20:51:52.371Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_242806c795d4385be9d7fafc50a"
[2023-01-12T20:51:52.530Z][QUERY]: DROP TABLE "template"
[2023-01-12T20:51:52.689Z][QUERY]: DROP TABLE "instant_session"
[2023-01-12T20:51:52.850Z][QUERY]: DROP TABLE "status_log"
[2023-01-12T20:51:53.007Z][QUERY]: DROP INDEX "REL_242806c795d4385be9d7fafc50" ON "lesson"
[2023-01-12T20:51:53.171Z][QUERY]: DROP TABLE "lesson"
[2023-01-12T20:51:53.336Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673550819110,"type":"bigint","params":[]},{"value":"addLessonTable1673550819110","type":"varchar","params":[]}]
[2023-01-12T20:51:53.517Z]Migration addLessonTable1673550819110 has been reverted successfully.
[2023-01-12T20:51:53.683Z][QUERY]: COMMIT
[2023-01-12T20:53:15.856Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-12T20:53:20.484Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-12T20:53:20.832Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-12T20:53:21.332Z]3 migrations are already loaded in the database.
[2023-01-12T20:53:21.332Z]4 migrations were found in the source code.
[2023-01-12T20:53:21.333Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-12T20:53:21.333Z]1 migrations are new migrations must be executed.
[2023-01-12T20:53:21.335Z][QUERY]: BEGIN TRANSACTION
[2023-01-12T20:53:21.644Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" nvarchar(255) NOT NULL, "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), "instantSessionRequestId" int, "tutorId" int, CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-12T20:53:21.816Z][QUERY]: CREATE UNIQUE INDEX "REL_242806c795d4385be9d7fafc50" ON "lesson" ("instantSessionRequestId") WHERE "instantSessionRequestId" IS NOT NULL
[2023-01-12T20:53:21.986Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "fromState" int NOT NULL, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), "requestInstantId" int, "lessonId" int, CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-12T20:53:22.147Z][QUERY]: CREATE TABLE "instant_session" ("id" int NOT NULL IDENTITY(1,1), "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_1bfbc51bd247a3cdabae2a5744a" DEFAULT 10, "cost" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_236dff4a6fe22e15d9540dd20e7" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_15e5d41ba41cd671d89d1e5984b" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, "keyStageLevelId" int, "subjectId" int, "studentId" int, "tutorId" int, CONSTRAINT "PK_07fa3ec79f85982f9f115d7b9ba" PRIMARY KEY ("id"))
[2023-01-12T20:53:22.316Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-12T20:53:22.492Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_242806c795d4385be9d7fafc50a" FOREIGN KEY ("instantSessionRequestId") REFERENCES "instant_session"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T20:53:22.651Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T20:53:22.813Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "instant_session"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T20:53:22.976Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T20:53:23.147Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T20:53:23.314Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_72f2e00b62114d054c665a8c368" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T20:53:23.474Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T20:53:23.633Z][QUERY]: ALTER TABLE "instant_session" ADD CONSTRAINT "FK_f6b47133af0a287228d64248984" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-12T20:53:23.796Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673556736507,"type":"bigint","params":[]},{"value":"addLessonTable1673556736507","type":"varchar","params":[]}]
[2023-01-12T20:53:23.964Z]Migration addLessonTable1673556736507 has been executed successfully.
[2023-01-12T20:53:24.121Z][QUERY]: COMMIT
[2023-01-13T09:04:43.149Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-13T09:04:47.901Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-13T09:04:48.282Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-13T09:04:48.597Z]4 migrations are already loaded in the database.
[2023-01-13T09:04:48.597Z]addLessonTable1673556736507 is the last executed migration. It was executed on Thu Jan 12 2023 20:52:16 GMT+0000 (Coordinated Universal Time).
[2023-01-13T09:04:48.598Z]Now reverting it...
[2023-01-13T09:04:48.599Z][QUERY]: BEGIN TRANSACTION
[2023-01-13T09:04:48.918Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_f6b47133af0a287228d64248984"
[2023-01-13T09:04:49.082Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_3c69b599924d5a384dd3b704ecc"
[2023-01-13T09:04:49.244Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_72f2e00b62114d054c665a8c368"
[2023-01-13T09:04:49.407Z][QUERY]: ALTER TABLE "instant_session" DROP CONSTRAINT "FK_2f876d2cd2808809eb8eaa1ae23"
[2023-01-13T09:04:49.574Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_77b3f1846ed47c723c8525ca223"
[2023-01-13T09:04:49.732Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-13T09:04:49.891Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_73366372b46c005d3c1e472a3f8"
[2023-01-13T09:04:50.063Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_242806c795d4385be9d7fafc50a"
[2023-01-13T09:04:50.296Z][QUERY]: DROP TABLE "template"
[2023-01-13T09:04:50.465Z][QUERY]: DROP TABLE "instant_session"
[2023-01-13T09:04:50.635Z][QUERY]: DROP TABLE "status_log"
[2023-01-13T09:04:50.795Z][QUERY]: DROP INDEX "REL_242806c795d4385be9d7fafc50" ON "lesson"
[2023-01-13T09:04:50.974Z][QUERY]: DROP TABLE "lesson"
[2023-01-13T09:04:51.144Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673556736507,"type":"bigint","params":[]},{"value":"addLessonTable1673556736507","type":"varchar","params":[]}]
[2023-01-13T09:04:51.310Z]Migration addLessonTable1673556736507 has been reverted successfully.
[2023-01-13T09:04:51.464Z][QUERY]: COMMIT
[2023-01-13T09:05:38.075Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-13T09:05:42.630Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-13T09:05:42.973Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-13T09:05:43.308Z]3 migrations are already loaded in the database.
[2023-01-13T09:05:43.308Z]4 migrations were found in the source code.
[2023-01-13T09:05:43.308Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-13T09:05:43.308Z]1 migrations are new migrations must be executed.
[2023-01-13T09:05:43.309Z][QUERY]: BEGIN TRANSACTION
[2023-01-13T09:05:44.393Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" nvarchar(255) NOT NULL, "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), "reqInstantId" int, "tutorId" int, CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-13T09:05:44.557Z][QUERY]: CREATE UNIQUE INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson" ("reqInstantId") WHERE "reqInstantId" IS NOT NULL
[2023-01-13T09:05:44.721Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "fromState" int NOT NULL, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), "requestInstantId" int, "lessonId" int, CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-13T09:05:44.916Z][QUERY]: CREATE TABLE "req_instant" ("id" int NOT NULL IDENTITY(1,1), "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_2af9af0405132ee54a51b387171" DEFAULT 10, "cost" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_10478adf2b6bdddeff5cc816e63" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_429fca86fb8c2a406ea6acb7fa5" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, "keyStageLevelId" int, "subjectId" int, "studentId" int, "tutorId" int, CONSTRAINT "PK_0df0c7f86cd18ce417bcb764eab" PRIMARY KEY ("id"))
[2023-01-13T09:05:45.083Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-13T09:05:45.250Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78" FOREIGN KEY ("reqInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T09:05:45.413Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T09:05:45.568Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T09:05:45.724Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T09:05:45.893Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_8c8098e310faf4db4165474845e" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T09:05:46.060Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T09:05:46.225Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T09:05:46.387Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_97e9454fcd0621a03478241d264" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T09:05:46.554Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673600710197,"type":"bigint","params":[]},{"value":"addLessonTable1673600710197","type":"varchar","params":[]}]
[2023-01-13T09:05:46.770Z]Migration addLessonTable1673600710197 has been executed successfully.
[2023-01-13T09:05:46.983Z][QUERY]: COMMIT
[2023-01-13T17:21:18.518Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-13T17:21:23.853Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-13T17:21:24.237Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-13T17:21:24.574Z]5 migrations are already loaded in the database.
[2023-01-13T17:21:24.593Z]transaction1673600911771 is the last executed migration. It was executed on Fri Jan 13 2023 09:08:31 GMT+0000 (Coordinated Universal Time).
[2023-01-13T17:21:24.593Z]Now reverting it...
[2023-01-13T17:21:24.596Z][QUERY]: BEGIN TRANSACTION
[2023-01-13T17:21:24.949Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_a458c11f312b6b23d68691b50c8"
[2023-01-13T17:21:25.122Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3"
[2023-01-13T17:21:25.303Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_4e1da5107fc718e03e363633a11"
[2023-01-13T17:21:25.467Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_eddf9d350e473527bd3b046df2e"
[2023-01-13T17:21:25.654Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8"
[2023-01-13T17:21:25.820Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5"
[2023-01-13T17:21:26.147Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_26023533594b6104821aca7dcfb"
[2023-01-13T17:21:26.331Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_5acc35de62f727155b44c5077cc"
[2023-01-13T17:21:26.500Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_67d6038132b6c74844c76541eb6"
[2023-01-13T17:21:26.662Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_1422cc85c1642eed91e947cf877"
[2023-01-13T17:21:26.828Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c"
[2023-01-13T17:21:27.061Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_e592cfeded04fe8a928abaa278f"
[2023-01-13T17:21:27.224Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5"
[2023-01-13T17:21:27.460Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69"
[2023-01-13T17:21:27.637Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_b54d41b45616caa71b38f3d792f"
[2023-01-13T17:21:27.805Z][QUERY]: DROP INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user"
[2023-01-13T17:21:27.970Z][QUERY]: DROP INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user"
[2023-01-13T17:21:28.150Z][QUERY]: DROP TABLE "funding_users_user"
[2023-01-13T17:21:28.329Z][QUERY]: DROP INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject"
[2023-01-13T17:21:28.510Z][QUERY]: DROP INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject"
[2023-01-13T17:21:28.759Z][QUERY]: DROP TABLE "funding_subjects_subject"
[2023-01-13T17:21:28.920Z][QUERY]: DROP INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction"
[2023-01-13T17:21:29.083Z][QUERY]: DROP INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction"
[2023-01-13T17:21:29.284Z][QUERY]: DROP TABLE "funding_transaction"
[2023-01-13T17:21:29.529Z][QUERY]: DROP INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction"
[2023-01-13T17:21:29.700Z][QUERY]: DROP INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction"
[2023-01-13T17:21:29.862Z][QUERY]: DROP INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction"
[2023-01-13T17:21:30.049Z][QUERY]: DROP INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction"
[2023-01-13T17:21:30.219Z][QUERY]: DROP TABLE "user_transaction"
[2023-01-13T17:21:30.382Z][QUERY]: DROP INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding"
[2023-01-13T17:21:30.638Z][QUERY]: DROP INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding"
[2023-01-13T17:21:30.818Z][QUERY]: DROP INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding"
[2023-01-13T17:21:31.006Z][QUERY]: DROP TABLE "funding"
[2023-01-13T17:21:31.168Z][QUERY]: DROP INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type"
[2023-01-13T17:21:31.352Z][QUERY]: DROP TABLE "funding_type"
[2023-01-13T17:21:31.520Z][QUERY]: DROP INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding"
[2023-01-13T17:21:31.680Z][QUERY]: DROP INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding"
[2023-01-13T17:21:31.891Z][QUERY]: DROP TABLE "student_in_funding"
[2023-01-13T17:21:32.056Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673600911771,"type":"bigint","params":[]},{"value":"transaction1673600911771","type":"varchar","params":[]}]
[2023-01-13T17:21:32.241Z]Migration transaction1673600911771 has been reverted successfully.
[2023-01-13T17:21:32.409Z][QUERY]: COMMIT
[2023-01-13T17:22:46.451Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-13T17:22:51.731Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-13T17:22:52.116Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-13T17:22:52.464Z]4 migrations are already loaded in the database.
[2023-01-13T17:22:52.464Z]addLessonTable1673600710197 is the last executed migration. It was executed on Fri Jan 13 2023 09:05:10 GMT+0000 (Coordinated Universal Time).
[2023-01-13T17:22:52.465Z]Now reverting it...
[2023-01-13T17:22:52.466Z][QUERY]: BEGIN TRANSACTION
[2023-01-13T17:22:52.777Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_97e9454fcd0621a03478241d264"
[2023-01-13T17:22:52.938Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077"
[2023-01-13T17:22:53.105Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630"
[2023-01-13T17:22:53.265Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_8c8098e310faf4db4165474845e"
[2023-01-13T17:22:53.423Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_77b3f1846ed47c723c8525ca223"
[2023-01-13T17:22:53.587Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-13T17:22:53.761Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_73366372b46c005d3c1e472a3f8"
[2023-01-13T17:22:53.928Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78"
[2023-01-13T17:22:54.092Z][QUERY]: DROP TABLE "template"
[2023-01-13T17:22:54.269Z][QUERY]: DROP TABLE "req_instant"
[2023-01-13T17:22:54.422Z][QUERY]: DROP TABLE "status_log"
[2023-01-13T17:22:54.575Z][QUERY]: DROP INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson"
[2023-01-13T17:22:54.746Z][QUERY]: DROP TABLE "lesson"
[2023-01-13T17:22:54.908Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673600710197,"type":"bigint","params":[]},{"value":"addLessonTable1673600710197","type":"varchar","params":[]}]
[2023-01-13T17:22:55.227Z]Migration addLessonTable1673600710197 has been reverted successfully.
[2023-01-13T17:22:55.399Z][QUERY]: COMMIT
[2023-01-13T17:23:28.971Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-13T17:23:34.136Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-13T17:23:34.475Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-13T17:23:34.845Z]3 migrations are already loaded in the database.
[2023-01-13T17:23:34.845Z]4 migrations were found in the source code.
[2023-01-13T17:23:34.845Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-13T17:23:34.845Z]1 migrations are new migrations must be executed.
[2023-01-13T17:23:34.847Z][QUERY]: BEGIN TRANSACTION
[2023-01-13T17:23:35.165Z][QUERY]: CREATE TABLE "student_in_funding" ("id" int NOT NULL IDENTITY(1,1), "studentId" int NOT NULL, "fundingId" int NOT NULL, "fundingAssigned" decimal(10,4) NOT NULL CONSTRAINT "DF_202265c09faad6ca0e62c05469a" DEFAULT 0, "fundingRemaining" decimal(10,4) NOT NULL CONSTRAINT "DF_8ffc82b9c4e37f4a511b5f47768" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_8ef4ab58fcadbf3c177d30d74cf" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_e23311139a698b3aad8151193e7" DEFAULT getUTCDate(), CONSTRAINT "PK_04a4ac0ca59cd474332d503e834" PRIMARY KEY ("id", "studentId", "fundingId"))
[2023-01-13T17:23:35.352Z][QUERY]: CREATE INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding" ("studentId") 
[2023-01-13T17:23:35.525Z][QUERY]: CREATE INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding" ("fundingId") 
[2023-01-13T17:23:35.715Z][QUERY]: CREATE TABLE "funding_type" ("id" int NOT NULL IDENTITY(1,1), "title" nvarchar(255) NOT NULL, CONSTRAINT "PK_9186aa2de0fecacc4270a171c72" PRIMARY KEY ("id"))
[2023-01-13T17:23:35.889Z][QUERY]: CREATE INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type" ("title") 
[2023-01-13T17:23:36.097Z][QUERY]: CREATE TABLE "funding" ("id" int NOT NULL IDENTITY(1,1), "stripeCustomerId" nvarchar(255), "numberOfAddedStudents" int NOT NULL CONSTRAINT "DF_c57e74a7c5b3317c9799737bb17" DEFAULT 0, "numberOfPendingStudents" int NOT NULL CONSTRAINT "DF_176c802cc15918cdca01f1b548b" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_652c617d0df737524e3822a4327" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_3208742513b8eeff356f9f43605" DEFAULT getUTCDate(), "fundingTypeId" int, "fundingOwnerUserId" int NOT NULL, "schoolId" int NOT NULL, CONSTRAINT "PK_096afc0d11a08deb52da61f039e" PRIMARY KEY ("id"))
[2023-01-13T17:23:36.338Z][QUERY]: CREATE INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding" ("fundingTypeId") 
[2023-01-13T17:23:36.497Z][QUERY]: CREATE INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding" ("fundingOwnerUserId") 
[2023-01-13T17:23:36.656Z][QUERY]: CREATE INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding" ("schoolId") 
[2023-01-13T17:23:36.818Z][QUERY]: CREATE TABLE "user_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_699ffce82f12a9f11d46796da48" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_760b65a581ec67dffeb38bb109_ENUM CHECK(type IN ('STUDENT_SELF_FUNDING_TOPUP','STUDENT_LESSON_FEE_PAY_SELF_FUNDING','STUDENT_LESSON_FEE_BACK_SELF_FUNDING','STUDENT_FUNDING_ASSIGN_FUND','STUDENT_LESSON_FEE_PAY_FUNDING','STUDENT_LESSON_FEE_BACK_FUNDING','PARENT_STUDENT_SELF_FUNDING_TOPUP','TUTOR_LESSON_EARN','TUTOR_WITHDRAW','SYSTEM_LESSON_SHARE')) NOT NULL, "userId" int NOT NULL, "lessonId" int, "fundingId" int, "studentUserId" int, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_70b2bdb02c290be0ec5ccf76bac" DEFAULT getUTCDate(), CONSTRAINT "PK_e36b77a5263ac0f191277c4c5d2" PRIMARY KEY ("id"))
[2023-01-13T17:23:36.988Z][QUERY]: CREATE INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction" ("userId") 
[2023-01-13T17:23:37.159Z][QUERY]: CREATE INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction" ("lessonId") 
[2023-01-13T17:23:37.375Z][QUERY]: CREATE INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction" ("fundingId") 
[2023-01-13T17:23:37.545Z][QUERY]: CREATE INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction" ("studentUserId") 
[2023-01-13T17:23:37.704Z][QUERY]: CREATE TABLE "funding_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_fd623e7139f320060ebd9e8202f" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_2c3637c858eb677b8f925aefd2_ENUM CHECK(type IN ('FUNDING_TOPUP','ASSIGN_FUND')) NOT NULL, "schoolId" int NOT NULL, "fundingId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_2524a1448f39955d3c01f38a328" DEFAULT getUTCDate(), CONSTRAINT "PK_7b3e2baa3c95e783431e97bb75f" PRIMARY KEY ("id"))
[2023-01-13T17:23:37.867Z][QUERY]: CREATE INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction" ("schoolId") 
[2023-01-13T17:23:38.049Z][QUERY]: CREATE INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction" ("fundingId") 
[2023-01-13T17:23:38.216Z][QUERY]: CREATE TABLE "funding_subjects_subject" ("fundingId" int NOT NULL, "subjectId" int NOT NULL, CONSTRAINT "PK_8ae7f8516810676bbbf751af142" PRIMARY KEY ("fundingId", "subjectId"))
[2023-01-13T17:23:38.376Z][QUERY]: CREATE INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject" ("fundingId") 
[2023-01-13T17:23:38.536Z][QUERY]: CREATE INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject" ("subjectId") 
[2023-01-13T17:23:38.714Z][QUERY]: CREATE TABLE "funding_users_user" ("fundingId" int NOT NULL, "userId" int NOT NULL, CONSTRAINT "PK_053ff2d5afb36e09b07caed95b1" PRIMARY KEY ("fundingId", "userId"))
[2023-01-13T17:23:38.887Z][QUERY]: CREATE INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user" ("fundingId") 
[2023-01-13T17:23:39.073Z][QUERY]: CREATE INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user" ("userId") 
[2023-01-13T17:23:39.298Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_b54d41b45616caa71b38f3d792f" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:23:39.464Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE NO ACTION
[2023-01-13T17:23:39.625Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5" FOREIGN KEY ("fundingTypeId") REFERENCES "funding_type"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:23:39.801Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_e592cfeded04fe8a928abaa278f" FOREIGN KEY ("fundingOwnerUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:23:39.992Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:23:40.158Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_1422cc85c1642eed91e947cf877" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:23:40.335Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_67d6038132b6c74844c76541eb6" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:23:41.005Z][FAILED QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_67d6038132b6c74844c76541eb6" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:23:41.005Z][QUERY ERROR]: QueryFailedError: Error
[2023-01-13T17:23:41.005Z]Migration "transaction1673600911771" failed, error: Error
[2023-01-13T17:25:46.523Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-13T17:25:51.423Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-13T17:25:51.807Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-13T17:25:52.162Z]3 migrations are already loaded in the database.
[2023-01-13T17:25:52.162Z]4 migrations were found in the source code.
[2023-01-13T17:25:52.162Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-13T17:25:52.162Z]1 migrations are new migrations must be executed.
[2023-01-13T17:25:52.163Z][QUERY]: BEGIN TRANSACTION
[2023-01-13T17:25:52.480Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" uniqueidentifier NOT NULL CONSTRAINT "DF_303f1fb6efe9f8fc384916c3fb7" DEFAULT NEWSEQUENTIALID(), "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), "reqInstantId" int, "tutorId" int, CONSTRAINT "UQ_303f1fb6efe9f8fc384916c3fb7" UNIQUE ("channelGUID"), CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-13T17:25:52.704Z][QUERY]: CREATE UNIQUE INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson" ("reqInstantId") WHERE "reqInstantId" IS NOT NULL
[2023-01-13T17:25:52.880Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "fromState" int NOT NULL, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), "requestInstantId" int, "lessonId" int, CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-13T17:25:53.068Z][QUERY]: CREATE TABLE "req_instant" ("id" int NOT NULL IDENTITY(1,1), "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_2af9af0405132ee54a51b387171" DEFAULT 10, "cost" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_10478adf2b6bdddeff5cc816e63" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_429fca86fb8c2a406ea6acb7fa5" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, "keyStageLevelId" int, "subjectId" int, "studentId" int, "tutorId" int, CONSTRAINT "PK_0df0c7f86cd18ce417bcb764eab" PRIMARY KEY ("id"))
[2023-01-13T17:25:53.270Z][QUERY]: CREATE TABLE "student_in_funding" ("id" int NOT NULL IDENTITY(1,1), "studentId" int NOT NULL, "fundingId" int NOT NULL, "fundingAssigned" decimal(10,4) NOT NULL CONSTRAINT "DF_202265c09faad6ca0e62c05469a" DEFAULT 0, "fundingRemaining" decimal(10,4) NOT NULL CONSTRAINT "DF_8ffc82b9c4e37f4a511b5f47768" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_8ef4ab58fcadbf3c177d30d74cf" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_e23311139a698b3aad8151193e7" DEFAULT getUTCDate(), CONSTRAINT "PK_04a4ac0ca59cd474332d503e834" PRIMARY KEY ("id", "studentId", "fundingId"))
[2023-01-13T17:25:53.463Z][QUERY]: CREATE INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding" ("studentId") 
[2023-01-13T17:25:53.630Z][QUERY]: CREATE INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding" ("fundingId") 
[2023-01-13T17:25:53.804Z][QUERY]: CREATE TABLE "funding_type" ("id" int NOT NULL IDENTITY(1,1), "title" nvarchar(255) NOT NULL, CONSTRAINT "PK_9186aa2de0fecacc4270a171c72" PRIMARY KEY ("id"))
[2023-01-13T17:25:53.980Z][QUERY]: CREATE INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type" ("title") 
[2023-01-13T17:25:54.157Z][QUERY]: CREATE TABLE "funding" ("id" int NOT NULL IDENTITY(1,1), "stripeCustomerId" nvarchar(255), "numberOfAddedStudents" int NOT NULL CONSTRAINT "DF_c57e74a7c5b3317c9799737bb17" DEFAULT 0, "numberOfPendingStudents" int NOT NULL CONSTRAINT "DF_176c802cc15918cdca01f1b548b" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_652c617d0df737524e3822a4327" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_3208742513b8eeff356f9f43605" DEFAULT getUTCDate(), "fundingTypeId" int, "fundingOwnerUserId" int NOT NULL, "schoolId" int NOT NULL, CONSTRAINT "PK_096afc0d11a08deb52da61f039e" PRIMARY KEY ("id"))
[2023-01-13T17:25:54.356Z][QUERY]: CREATE INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding" ("fundingTypeId") 
[2023-01-13T17:25:54.557Z][QUERY]: CREATE INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding" ("fundingOwnerUserId") 
[2023-01-13T17:25:54.734Z][QUERY]: CREATE INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding" ("schoolId") 
[2023-01-13T17:25:54.978Z][QUERY]: CREATE TABLE "funding_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_fd623e7139f320060ebd9e8202f" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_2c3637c858eb677b8f925aefd2_ENUM CHECK(type IN ('FUNDING_TOPUP','ASSIGN_FUND')) NOT NULL, "schoolId" int NOT NULL, "fundingId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_2524a1448f39955d3c01f38a328" DEFAULT getUTCDate(), CONSTRAINT "PK_7b3e2baa3c95e783431e97bb75f" PRIMARY KEY ("id"))
[2023-01-13T17:25:55.178Z][QUERY]: CREATE INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction" ("schoolId") 
[2023-01-13T17:25:55.354Z][QUERY]: CREATE INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction" ("fundingId") 
[2023-01-13T17:25:55.525Z][QUERY]: CREATE TABLE "user_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_699ffce82f12a9f11d46796da48" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_760b65a581ec67dffeb38bb109_ENUM CHECK(type IN ('STUDENT_SELF_FUNDING_TOPUP','STUDENT_LESSON_FEE_PAY_SELF_FUNDING','STUDENT_LESSON_FEE_BACK_SELF_FUNDING','STUDENT_FUNDING_ASSIGN_FUND','STUDENT_LESSON_FEE_PAY_FUNDING','STUDENT_LESSON_FEE_BACK_FUNDING','PARENT_STUDENT_SELF_FUNDING_TOPUP','TUTOR_LESSON_EARN','TUTOR_WITHDRAW','SYSTEM_LESSON_SHARE')) NOT NULL, "userId" int NOT NULL, "lessonId" int, "fundingId" int, "studentUserId" int, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_70b2bdb02c290be0ec5ccf76bac" DEFAULT getUTCDate(), CONSTRAINT "PK_e36b77a5263ac0f191277c4c5d2" PRIMARY KEY ("id"))
[2023-01-13T17:25:55.694Z][QUERY]: CREATE INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction" ("userId") 
[2023-01-13T17:25:55.857Z][QUERY]: CREATE INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction" ("lessonId") 
[2023-01-13T17:25:56.025Z][QUERY]: CREATE INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction" ("fundingId") 
[2023-01-13T17:25:56.188Z][QUERY]: CREATE INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction" ("studentUserId") 
[2023-01-13T17:25:56.367Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-13T17:25:56.557Z][QUERY]: CREATE TABLE "funding_subjects_subject" ("fundingId" int NOT NULL, "subjectId" int NOT NULL, CONSTRAINT "PK_8ae7f8516810676bbbf751af142" PRIMARY KEY ("fundingId", "subjectId"))
[2023-01-13T17:25:56.735Z][QUERY]: CREATE INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject" ("fundingId") 
[2023-01-13T17:25:56.907Z][QUERY]: CREATE INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject" ("subjectId") 
[2023-01-13T17:25:57.080Z][QUERY]: CREATE TABLE "funding_users_user" ("fundingId" int NOT NULL, "userId" int NOT NULL, CONSTRAINT "PK_053ff2d5afb36e09b07caed95b1" PRIMARY KEY ("fundingId", "userId"))
[2023-01-13T17:25:57.239Z][QUERY]: CREATE INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user" ("fundingId") 
[2023-01-13T17:25:57.406Z][QUERY]: CREATE INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user" ("userId") 
[2023-01-13T17:25:57.567Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78" FOREIGN KEY ("reqInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:25:57.747Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:25:57.912Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:25:58.095Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:25:58.262Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_8c8098e310faf4db4165474845e" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:25:58.429Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:25:58.638Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:25:58.843Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_97e9454fcd0621a03478241d264" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:25:59.007Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_b54d41b45616caa71b38f3d792f" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:25:59.179Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE NO ACTION
[2023-01-13T17:25:59.426Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5" FOREIGN KEY ("fundingTypeId") REFERENCES "funding_type"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:25:59.686Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_e592cfeded04fe8a928abaa278f" FOREIGN KEY ("fundingOwnerUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:25:59.865Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:26:00.108Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:26:00.271Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:26:00.443Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_1422cc85c1642eed91e947cf877" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:26:00.643Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_67d6038132b6c74844c76541eb6" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:26:00.799Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_5acc35de62f727155b44c5077cc" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:26:00.962Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_26023533594b6104821aca7dcfb" FOREIGN KEY ("studentUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:26:01.147Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_eddf9d350e473527bd3b046df2e" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-13T17:26:01.396Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_4e1da5107fc718e03e363633a11" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-13T17:26:01.569Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-13T17:26:01.734Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_a458c11f312b6b23d68691b50c8" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-13T17:26:01.918Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673630718528,"type":"bigint","params":[]},{"value":"lessonTableAndTransactions1673630718528","type":"varchar","params":[]}]
[2023-01-13T17:26:02.084Z]Migration lessonTableAndTransactions1673630718528 has been executed successfully.
[2023-01-13T17:26:02.256Z][QUERY]: COMMIT
[2023-01-13T17:34:20.262Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-13T17:34:25.850Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-13T17:34:26.230Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-13T17:34:26.594Z]4 migrations are already loaded in the database.
[2023-01-13T17:34:26.595Z]lessonTableAndTransactions1673630718528 is the last executed migration. It was executed on Fri Jan 13 2023 17:25:18 GMT+0000 (Coordinated Universal Time).
[2023-01-13T17:34:26.595Z]Now reverting it...
[2023-01-13T17:34:26.596Z][QUERY]: BEGIN TRANSACTION
[2023-01-13T17:34:26.995Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_a458c11f312b6b23d68691b50c8"
[2023-01-13T17:34:27.160Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3"
[2023-01-13T17:34:27.340Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_4e1da5107fc718e03e363633a11"
[2023-01-13T17:34:27.601Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_eddf9d350e473527bd3b046df2e"
[2023-01-13T17:34:27.755Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_26023533594b6104821aca7dcfb"
[2023-01-13T17:34:27.949Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_5acc35de62f727155b44c5077cc"
[2023-01-13T17:34:28.131Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_67d6038132b6c74844c76541eb6"
[2023-01-13T17:34:28.307Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_1422cc85c1642eed91e947cf877"
[2023-01-13T17:34:28.474Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8"
[2023-01-13T17:34:28.640Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5"
[2023-01-13T17:34:28.806Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c"
[2023-01-13T17:34:28.978Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_e592cfeded04fe8a928abaa278f"
[2023-01-13T17:34:29.140Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5"
[2023-01-13T17:34:29.303Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69"
[2023-01-13T17:34:29.542Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_b54d41b45616caa71b38f3d792f"
[2023-01-13T17:34:29.720Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_97e9454fcd0621a03478241d264"
[2023-01-13T17:34:29.919Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077"
[2023-01-13T17:34:30.093Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630"
[2023-01-13T17:34:30.256Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_8c8098e310faf4db4165474845e"
[2023-01-13T17:34:30.432Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_77b3f1846ed47c723c8525ca223"
[2023-01-13T17:34:30.596Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-13T17:34:30.771Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_73366372b46c005d3c1e472a3f8"
[2023-01-13T17:34:30.931Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78"
[2023-01-13T17:34:31.118Z][QUERY]: DROP INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user"
[2023-01-13T17:34:31.291Z][QUERY]: DROP INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user"
[2023-01-13T17:34:31.452Z][QUERY]: DROP TABLE "funding_users_user"
[2023-01-13T17:34:31.612Z][QUERY]: DROP INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject"
[2023-01-13T17:34:31.765Z][QUERY]: DROP INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject"
[2023-01-13T17:34:31.929Z][QUERY]: DROP TABLE "funding_subjects_subject"
[2023-01-13T17:34:32.133Z][QUERY]: DROP TABLE "template"
[2023-01-13T17:34:32.292Z][QUERY]: DROP INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction"
[2023-01-13T17:34:32.450Z][QUERY]: DROP INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction"
[2023-01-13T17:34:32.622Z][QUERY]: DROP INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction"
[2023-01-13T17:34:32.952Z][QUERY]: DROP INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction"
[2023-01-13T17:34:33.116Z][QUERY]: DROP TABLE "user_transaction"
[2023-01-13T17:34:33.297Z][QUERY]: DROP INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction"
[2023-01-13T17:34:33.479Z][QUERY]: DROP INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction"
[2023-01-13T17:34:33.633Z][QUERY]: DROP TABLE "funding_transaction"
[2023-01-13T17:34:33.800Z][QUERY]: DROP INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding"
[2023-01-13T17:34:34.019Z][QUERY]: DROP INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding"
[2023-01-13T17:34:34.197Z][QUERY]: DROP INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding"
[2023-01-13T17:34:34.385Z][QUERY]: DROP TABLE "funding"
[2023-01-13T17:34:34.554Z][QUERY]: DROP INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type"
[2023-01-13T17:34:34.713Z][QUERY]: DROP TABLE "funding_type"
[2023-01-13T17:34:34.888Z][QUERY]: DROP INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding"
[2023-01-13T17:34:35.061Z][QUERY]: DROP INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding"
[2023-01-13T17:34:35.300Z][QUERY]: DROP TABLE "student_in_funding"
[2023-01-13T17:34:35.464Z][QUERY]: DROP TABLE "req_instant"
[2023-01-13T17:34:35.634Z][QUERY]: DROP TABLE "status_log"
[2023-01-13T17:34:35.790Z][QUERY]: DROP INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson"
[2023-01-13T17:34:35.960Z][QUERY]: DROP TABLE "lesson"
[2023-01-13T17:34:36.135Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673630718528,"type":"bigint","params":[]},{"value":"lessonTableAndTransactions1673630718528","type":"varchar","params":[]}]
[2023-01-13T17:34:36.312Z]Migration lessonTableAndTransactions1673630718528 has been reverted successfully.
[2023-01-13T17:34:36.481Z][QUERY]: COMMIT
[2023-01-13T17:36:44.838Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-13T17:36:49.946Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-13T17:36:50.362Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-13T17:36:50.700Z]3 migrations are already loaded in the database.
[2023-01-13T17:36:50.700Z]4 migrations were found in the source code.
[2023-01-13T17:36:50.700Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-13T17:36:50.701Z]1 migrations are new migrations must be executed.
[2023-01-13T17:36:50.702Z][QUERY]: BEGIN TRANSACTION
[2023-01-13T17:36:51.026Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" uniqueidentifier NOT NULL CONSTRAINT "DF_303f1fb6efe9f8fc384916c3fb7" DEFAULT NEWSEQUENTIALID(), "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), "reqInstantId" int, "tutorId" int, CONSTRAINT "UQ_303f1fb6efe9f8fc384916c3fb7" UNIQUE ("channelGUID"), CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-13T17:36:51.204Z][QUERY]: CREATE UNIQUE INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson" ("reqInstantId") WHERE "reqInstantId" IS NOT NULL
[2023-01-13T17:36:51.369Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "fromState" int NOT NULL, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), "requestInstantId" int, "lessonId" int, CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-13T17:36:51.608Z][QUERY]: CREATE TABLE "req_instant" ("id" int NOT NULL IDENTITY(1,1), "keyStageLevelId" int NOT NULL, "subjectId" int NOT NULL, "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_2af9af0405132ee54a51b387171" DEFAULT 10, "cost" int NOT NULL, "studentId" int NOT NULL, "tutorId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_10478adf2b6bdddeff5cc816e63" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_429fca86fb8c2a406ea6acb7fa5" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, CONSTRAINT "PK_0df0c7f86cd18ce417bcb764eab" PRIMARY KEY ("id"))
[2023-01-13T17:36:51.793Z][QUERY]: CREATE TABLE "student_in_funding" ("id" int NOT NULL IDENTITY(1,1), "studentId" int NOT NULL, "fundingId" int NOT NULL, "fundingAssigned" decimal(10,4) NOT NULL CONSTRAINT "DF_202265c09faad6ca0e62c05469a" DEFAULT 0, "fundingRemaining" decimal(10,4) NOT NULL CONSTRAINT "DF_8ffc82b9c4e37f4a511b5f47768" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_8ef4ab58fcadbf3c177d30d74cf" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_e23311139a698b3aad8151193e7" DEFAULT getUTCDate(), CONSTRAINT "PK_04a4ac0ca59cd474332d503e834" PRIMARY KEY ("id", "studentId", "fundingId"))
[2023-01-13T17:36:51.995Z][QUERY]: CREATE INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding" ("studentId") 
[2023-01-13T17:36:52.163Z][QUERY]: CREATE INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding" ("fundingId") 
[2023-01-13T17:36:52.324Z][QUERY]: CREATE TABLE "funding_type" ("id" int NOT NULL IDENTITY(1,1), "title" nvarchar(255) NOT NULL, CONSTRAINT "PK_9186aa2de0fecacc4270a171c72" PRIMARY KEY ("id"))
[2023-01-13T17:36:52.492Z][QUERY]: CREATE INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type" ("title") 
[2023-01-13T17:36:52.659Z][QUERY]: CREATE TABLE "funding" ("id" int NOT NULL IDENTITY(1,1), "stripeCustomerId" nvarchar(255), "numberOfAddedStudents" int NOT NULL CONSTRAINT "DF_c57e74a7c5b3317c9799737bb17" DEFAULT 0, "numberOfPendingStudents" int NOT NULL CONSTRAINT "DF_176c802cc15918cdca01f1b548b" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_652c617d0df737524e3822a4327" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_3208742513b8eeff356f9f43605" DEFAULT getUTCDate(), "fundingTypeId" int, "fundingOwnerUserId" int NOT NULL, "schoolId" int NOT NULL, CONSTRAINT "PK_096afc0d11a08deb52da61f039e" PRIMARY KEY ("id"))
[2023-01-13T17:36:52.916Z][QUERY]: CREATE INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding" ("fundingTypeId") 
[2023-01-13T17:36:53.082Z][QUERY]: CREATE INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding" ("fundingOwnerUserId") 
[2023-01-13T17:36:53.251Z][QUERY]: CREATE INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding" ("schoolId") 
[2023-01-13T17:36:53.421Z][QUERY]: CREATE TABLE "funding_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_fd623e7139f320060ebd9e8202f" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_2c3637c858eb677b8f925aefd2_ENUM CHECK(type IN ('FUNDING_TOPUP','ASSIGN_FUND')) NOT NULL, "schoolId" int NOT NULL, "fundingId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_2524a1448f39955d3c01f38a328" DEFAULT getUTCDate(), CONSTRAINT "PK_7b3e2baa3c95e783431e97bb75f" PRIMARY KEY ("id"))
[2023-01-13T17:36:53.603Z][QUERY]: CREATE INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction" ("schoolId") 
[2023-01-13T17:36:53.773Z][QUERY]: CREATE INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction" ("fundingId") 
[2023-01-13T17:36:53.933Z][QUERY]: CREATE TABLE "user_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_699ffce82f12a9f11d46796da48" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_760b65a581ec67dffeb38bb109_ENUM CHECK(type IN ('STUDENT_SELF_FUNDING_TOPUP','STUDENT_LESSON_FEE_PAY_SELF_FUNDING','STUDENT_LESSON_FEE_BACK_SELF_FUNDING','STUDENT_FUNDING_ASSIGN_FUND','STUDENT_LESSON_FEE_PAY_FUNDING','STUDENT_LESSON_FEE_BACK_FUNDING','PARENT_STUDENT_SELF_FUNDING_TOPUP','TUTOR_LESSON_EARN','TUTOR_WITHDRAW','SYSTEM_LESSON_SHARE')) NOT NULL, "userId" int NOT NULL, "lessonId" int, "fundingId" int, "studentUserId" int, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_70b2bdb02c290be0ec5ccf76bac" DEFAULT getUTCDate(), CONSTRAINT "PK_e36b77a5263ac0f191277c4c5d2" PRIMARY KEY ("id"))
[2023-01-13T17:36:54.174Z][QUERY]: CREATE INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction" ("userId") 
[2023-01-13T17:36:54.343Z][QUERY]: CREATE INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction" ("lessonId") 
[2023-01-13T17:36:54.505Z][QUERY]: CREATE INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction" ("fundingId") 
[2023-01-13T17:36:54.673Z][QUERY]: CREATE INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction" ("studentUserId") 
[2023-01-13T17:36:54.834Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-13T17:36:55.022Z][QUERY]: CREATE TABLE "funding_subjects_subject" ("fundingId" int NOT NULL, "subjectId" int NOT NULL, CONSTRAINT "PK_8ae7f8516810676bbbf751af142" PRIMARY KEY ("fundingId", "subjectId"))
[2023-01-13T17:36:55.196Z][QUERY]: CREATE INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject" ("fundingId") 
[2023-01-13T17:36:55.364Z][QUERY]: CREATE INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject" ("subjectId") 
[2023-01-13T17:36:55.540Z][QUERY]: CREATE TABLE "funding_users_user" ("fundingId" int NOT NULL, "userId" int NOT NULL, CONSTRAINT "PK_053ff2d5afb36e09b07caed95b1" PRIMARY KEY ("fundingId", "userId"))
[2023-01-13T17:36:55.709Z][QUERY]: CREATE INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user" ("fundingId") 
[2023-01-13T17:36:55.872Z][QUERY]: CREATE INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user" ("userId") 
[2023-01-13T17:36:56.085Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78" FOREIGN KEY ("reqInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:56.253Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:56.430Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:56.592Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:56.773Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_8c8098e310faf4db4165474845e" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:56.954Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:57.120Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:57.389Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_97e9454fcd0621a03478241d264" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:57.552Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_b54d41b45616caa71b38f3d792f" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:57.721Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE NO ACTION
[2023-01-13T17:36:57.891Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5" FOREIGN KEY ("fundingTypeId") REFERENCES "funding_type"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:58.059Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_e592cfeded04fe8a928abaa278f" FOREIGN KEY ("fundingOwnerUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:58.220Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:58.398Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:58.559Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:58.720Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_1422cc85c1642eed91e947cf877" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:58.890Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_67d6038132b6c74844c76541eb6" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:59.043Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_5acc35de62f727155b44c5077cc" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:59.198Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_26023533594b6104821aca7dcfb" FOREIGN KEY ("studentUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-13T17:36:59.373Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_eddf9d350e473527bd3b046df2e" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-13T17:36:59.525Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_4e1da5107fc718e03e363633a11" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-13T17:36:59.691Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-13T17:36:59.893Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_a458c11f312b6b23d68691b50c8" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-13T17:37:00.083Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673631368528,"type":"bigint","params":[]},{"value":"lessonTableAndTransactions1673631368528","type":"varchar","params":[]}]
[2023-01-13T17:37:00.260Z]Migration lessonTableAndTransactions1673631368528 has been executed successfully.
[2023-01-13T17:37:00.429Z][QUERY]: COMMIT
[2023-01-17T05:51:17.878Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-17T05:51:28.151Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-17T05:51:28.567Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-17T05:51:28.919Z]4 migrations are already loaded in the database.
[2023-01-17T05:51:28.972Z]lessonTableAndTransactions1673631368528 is the last executed migration. It was executed on Fri Jan 13 2023 17:36:08 GMT+0000 (Coordinated Universal Time).
[2023-01-17T05:51:28.973Z]Now reverting it...
[2023-01-17T05:51:28.976Z][QUERY]: BEGIN TRANSACTION
[2023-01-17T05:51:29.371Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_a458c11f312b6b23d68691b50c8"
[2023-01-17T05:51:29.545Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3"
[2023-01-17T05:51:29.745Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_4e1da5107fc718e03e363633a11"
[2023-01-17T05:51:29.947Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_eddf9d350e473527bd3b046df2e"
[2023-01-17T05:51:30.145Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_26023533594b6104821aca7dcfb"
[2023-01-17T05:51:30.344Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_5acc35de62f727155b44c5077cc"
[2023-01-17T05:51:30.506Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_67d6038132b6c74844c76541eb6"
[2023-01-17T05:51:30.705Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_1422cc85c1642eed91e947cf877"
[2023-01-17T05:51:30.865Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8"
[2023-01-17T05:51:31.025Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5"
[2023-01-17T05:51:31.224Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c"
[2023-01-17T05:51:31.385Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_e592cfeded04fe8a928abaa278f"
[2023-01-17T05:51:31.584Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5"
[2023-01-17T05:51:31.744Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69"
[2023-01-17T05:51:31.905Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_b54d41b45616caa71b38f3d792f"
[2023-01-17T05:51:32.066Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_97e9454fcd0621a03478241d264"
[2023-01-17T05:51:32.264Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077"
[2023-01-17T05:51:32.424Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630"
[2023-01-17T05:51:32.585Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_8c8098e310faf4db4165474845e"
[2023-01-17T05:51:32.784Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_77b3f1846ed47c723c8525ca223"
[2023-01-17T05:51:32.945Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-17T05:51:33.112Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_73366372b46c005d3c1e472a3f8"
[2023-01-17T05:51:33.313Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78"
[2023-01-17T05:51:33.504Z][QUERY]: DROP INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user"
[2023-01-17T05:51:33.665Z][QUERY]: DROP INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user"
[2023-01-17T05:51:33.825Z][QUERY]: DROP TABLE "funding_users_user"
[2023-01-17T05:51:33.992Z][QUERY]: DROP INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject"
[2023-01-17T05:51:34.186Z][QUERY]: DROP INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject"
[2023-01-17T05:51:34.353Z][QUERY]: DROP TABLE "funding_subjects_subject"
[2023-01-17T05:51:34.544Z][QUERY]: DROP TABLE "template"
[2023-01-17T05:51:34.713Z][QUERY]: DROP INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction"
[2023-01-17T05:51:34.904Z][QUERY]: DROP INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction"
[2023-01-17T05:51:35.064Z][QUERY]: DROP INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction"
[2023-01-17T05:51:35.264Z][QUERY]: DROP INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction"
[2023-01-17T05:51:35.431Z][QUERY]: DROP TABLE "user_transaction"
[2023-01-17T05:51:35.624Z][QUERY]: DROP INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction"
[2023-01-17T05:51:35.784Z][QUERY]: DROP INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction"
[2023-01-17T05:51:35.944Z][QUERY]: DROP TABLE "funding_transaction"
[2023-01-17T05:51:36.107Z][QUERY]: DROP INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding"
[2023-01-17T05:51:36.304Z][QUERY]: DROP INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding"
[2023-01-17T05:51:36.473Z][QUERY]: DROP INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding"
[2023-01-17T05:51:36.632Z][QUERY]: DROP TABLE "funding"
[2023-01-17T05:51:36.824Z][QUERY]: DROP INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type"
[2023-01-17T05:51:36.985Z][QUERY]: DROP TABLE "funding_type"
[2023-01-17T05:51:37.152Z][QUERY]: DROP INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding"
[2023-01-17T05:51:37.383Z][QUERY]: DROP INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding"
[2023-01-17T05:51:37.560Z][QUERY]: DROP TABLE "student_in_funding"
[2023-01-17T05:51:37.724Z][QUERY]: DROP TABLE "req_instant"
[2023-01-17T05:51:37.902Z][QUERY]: DROP TABLE "status_log"
[2023-01-17T05:51:38.072Z][QUERY]: DROP INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson"
[2023-01-17T05:51:38.263Z][QUERY]: DROP TABLE "lesson"
[2023-01-17T05:51:38.432Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673631368528,"type":"bigint","params":[]},{"value":"lessonTableAndTransactions1673631368528","type":"varchar","params":[]}]
[2023-01-17T05:51:38.662Z]Migration lessonTableAndTransactions1673631368528 has been reverted successfully.
[2023-01-17T05:51:38.823Z][QUERY]: COMMIT
[2023-01-17T05:52:57.120Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-17T05:53:02.688Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-17T05:53:04.202Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-17T05:53:04.597Z]3 migrations are already loaded in the database.
[2023-01-17T05:53:04.597Z]4 migrations were found in the source code.
[2023-01-17T05:53:04.597Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-17T05:53:04.598Z]1 migrations are new migrations must be executed.
[2023-01-17T05:53:04.600Z][QUERY]: BEGIN TRANSACTION
[2023-01-17T05:53:05.499Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "reqInstantId" int NOT NULL, "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" uniqueidentifier NOT NULL CONSTRAINT "DF_303f1fb6efe9f8fc384916c3fb7" DEFAULT NEWSEQUENTIALID(), "tutorId" int NOT NULL, "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), CONSTRAINT "UQ_303f1fb6efe9f8fc384916c3fb7" UNIQUE ("channelGUID"), CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-17T05:53:05.706Z][QUERY]: CREATE UNIQUE INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson" ("reqInstantId") WHERE "reqInstantId" IS NOT NULL
[2023-01-17T05:53:05.912Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int NOT NULL, "lessonId" int NOT NULL, "fromState" int NOT NULL, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-17T05:53:06.128Z][QUERY]: CREATE TABLE "req_instant" ("id" int NOT NULL IDENTITY(1,1), "keyStageLevelId" int NOT NULL, "subjectId" int NOT NULL, "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_2af9af0405132ee54a51b387171" DEFAULT 10, "cost" int NOT NULL, "studentId" int NOT NULL, "tutorId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_10478adf2b6bdddeff5cc816e63" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_429fca86fb8c2a406ea6acb7fa5" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, CONSTRAINT "PK_0df0c7f86cd18ce417bcb764eab" PRIMARY KEY ("id"))
[2023-01-17T05:53:06.325Z][QUERY]: CREATE TABLE "student_in_funding" ("id" int NOT NULL IDENTITY(1,1), "studentId" int NOT NULL, "fundingId" int NOT NULL, "fundingAssigned" decimal(10,4) NOT NULL CONSTRAINT "DF_202265c09faad6ca0e62c05469a" DEFAULT 0, "fundingRemaining" decimal(10,4) NOT NULL CONSTRAINT "DF_8ffc82b9c4e37f4a511b5f47768" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_8ef4ab58fcadbf3c177d30d74cf" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_e23311139a698b3aad8151193e7" DEFAULT getUTCDate(), CONSTRAINT "PK_04a4ac0ca59cd474332d503e834" PRIMARY KEY ("id", "studentId", "fundingId"))
[2023-01-17T05:53:06.943Z][QUERY]: CREATE INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding" ("studentId") 
[2023-01-17T05:53:07.127Z][QUERY]: CREATE INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding" ("fundingId") 
[2023-01-17T05:53:07.326Z][QUERY]: CREATE TABLE "funding_type" ("id" int NOT NULL IDENTITY(1,1), "title" nvarchar(255) NOT NULL, CONSTRAINT "PK_9186aa2de0fecacc4270a171c72" PRIMARY KEY ("id"))
[2023-01-17T05:53:07.526Z][QUERY]: CREATE INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type" ("title") 
[2023-01-17T05:53:07.693Z][QUERY]: CREATE TABLE "funding" ("id" int NOT NULL IDENTITY(1,1), "stripeCustomerId" nvarchar(255), "numberOfAddedStudents" int NOT NULL CONSTRAINT "DF_c57e74a7c5b3317c9799737bb17" DEFAULT 0, "numberOfPendingStudents" int NOT NULL CONSTRAINT "DF_176c802cc15918cdca01f1b548b" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_652c617d0df737524e3822a4327" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_3208742513b8eeff356f9f43605" DEFAULT getUTCDate(), "fundingTypeId" int, "fundingOwnerUserId" int NOT NULL, "schoolId" int NOT NULL, CONSTRAINT "PK_096afc0d11a08deb52da61f039e" PRIMARY KEY ("id"))
[2023-01-17T05:53:07.887Z][QUERY]: CREATE INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding" ("fundingTypeId") 
[2023-01-17T05:53:08.056Z][QUERY]: CREATE INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding" ("fundingOwnerUserId") 
[2023-01-17T05:53:08.247Z][QUERY]: CREATE INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding" ("schoolId") 
[2023-01-17T05:53:08.446Z][QUERY]: CREATE TABLE "funding_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_fd623e7139f320060ebd9e8202f" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_2c3637c858eb677b8f925aefd2_ENUM CHECK(type IN ('FUNDING_TOPUP','ASSIGN_FUND')) NOT NULL, "schoolId" int NOT NULL, "fundingId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_2524a1448f39955d3c01f38a328" DEFAULT getUTCDate(), CONSTRAINT "PK_7b3e2baa3c95e783431e97bb75f" PRIMARY KEY ("id"))
[2023-01-17T05:53:08.615Z][QUERY]: CREATE INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction" ("schoolId") 
[2023-01-17T05:53:08.807Z][QUERY]: CREATE INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction" ("fundingId") 
[2023-01-17T05:53:09.007Z][QUERY]: CREATE TABLE "user_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_699ffce82f12a9f11d46796da48" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_760b65a581ec67dffeb38bb109_ENUM CHECK(type IN ('STUDENT_SELF_FUNDING_TOPUP','STUDENT_LESSON_FEE_PAY_SELF_FUNDING','STUDENT_LESSON_FEE_BACK_SELF_FUNDING','STUDENT_FUNDING_ASSIGN_FUND','STUDENT_LESSON_FEE_PAY_FUNDING','STUDENT_LESSON_FEE_BACK_FUNDING','PARENT_STUDENT_SELF_FUNDING_TOPUP','TUTOR_LESSON_EARN','TUTOR_WITHDRAW','SYSTEM_LESSON_SHARE')) NOT NULL, "userId" int NOT NULL, "lessonId" int, "fundingId" int, "studentUserId" int, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_70b2bdb02c290be0ec5ccf76bac" DEFAULT getUTCDate(), CONSTRAINT "PK_e36b77a5263ac0f191277c4c5d2" PRIMARY KEY ("id"))
[2023-01-17T05:53:09.184Z][QUERY]: CREATE INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction" ("userId") 
[2023-01-17T05:53:09.346Z][QUERY]: CREATE INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction" ("lessonId") 
[2023-01-17T05:53:09.526Z][QUERY]: CREATE INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction" ("fundingId") 
[2023-01-17T05:53:09.694Z][QUERY]: CREATE INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction" ("studentUserId") 
[2023-01-17T05:53:09.854Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-17T05:53:10.045Z][QUERY]: CREATE TABLE "funding_subjects_subject" ("fundingId" int NOT NULL, "subjectId" int NOT NULL, CONSTRAINT "PK_8ae7f8516810676bbbf751af142" PRIMARY KEY ("fundingId", "subjectId"))
[2023-01-17T05:53:10.287Z][QUERY]: CREATE INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject" ("fundingId") 
[2023-01-17T05:53:10.453Z][QUERY]: CREATE INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject" ("subjectId") 
[2023-01-17T05:53:10.612Z][QUERY]: CREATE TABLE "funding_users_user" ("fundingId" int NOT NULL, "userId" int NOT NULL, CONSTRAINT "PK_053ff2d5afb36e09b07caed95b1" PRIMARY KEY ("fundingId", "userId"))
[2023-01-17T05:53:10.807Z][QUERY]: CREATE INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user" ("fundingId") 
[2023-01-17T05:53:10.974Z][QUERY]: CREATE INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user" ("userId") 
[2023-01-17T05:53:11.133Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78" FOREIGN KEY ("reqInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:11.301Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:11.486Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:11.655Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:11.826Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_8c8098e310faf4db4165474845e" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:12.005Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:12.189Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:12.360Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_97e9454fcd0621a03478241d264" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:12.531Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_b54d41b45616caa71b38f3d792f" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:12.694Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE NO ACTION
[2023-01-17T05:53:12.852Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5" FOREIGN KEY ("fundingTypeId") REFERENCES "funding_type"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:13.018Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_e592cfeded04fe8a928abaa278f" FOREIGN KEY ("fundingOwnerUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:13.210Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:13.374Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:13.534Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:13.725Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_1422cc85c1642eed91e947cf877" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:13.893Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_67d6038132b6c74844c76541eb6" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:14.065Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_5acc35de62f727155b44c5077cc" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:14.251Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_26023533594b6104821aca7dcfb" FOREIGN KEY ("studentUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T05:53:14.414Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_eddf9d350e473527bd3b046df2e" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T05:53:14.605Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_4e1da5107fc718e03e363633a11" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T05:53:14.806Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T05:53:14.973Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_a458c11f312b6b23d68691b50c8" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T05:53:15.143Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673934738831,"type":"bigint","params":[]},{"value":"lessonStatuslogTransaction1673934738831","type":"varchar","params":[]}]
[2023-01-17T05:53:15.522Z]Migration lessonStatuslogTransaction1673934738831 has been executed successfully.
[2023-01-17T05:53:15.686Z][QUERY]: COMMIT
[2023-01-17T06:11:47.071Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-17T06:11:54.258Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-17T06:11:54.602Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-17T06:11:54.939Z]4 migrations are already loaded in the database.
[2023-01-17T06:11:54.939Z]lessonStatuslogTransaction1673934738831 is the last executed migration. It was executed on Tue Jan 17 2023 05:52:18 GMT+0000 (Coordinated Universal Time).
[2023-01-17T06:11:54.939Z]Now reverting it...
[2023-01-17T06:11:54.941Z][QUERY]: BEGIN TRANSACTION
[2023-01-17T06:11:55.252Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_a458c11f312b6b23d68691b50c8"
[2023-01-17T06:11:55.422Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3"
[2023-01-17T06:11:55.593Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_4e1da5107fc718e03e363633a11"
[2023-01-17T06:11:55.769Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_eddf9d350e473527bd3b046df2e"
[2023-01-17T06:11:55.931Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_26023533594b6104821aca7dcfb"
[2023-01-17T06:11:56.092Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_5acc35de62f727155b44c5077cc"
[2023-01-17T06:11:56.262Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_67d6038132b6c74844c76541eb6"
[2023-01-17T06:11:56.432Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_1422cc85c1642eed91e947cf877"
[2023-01-17T06:11:56.650Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8"
[2023-01-17T06:11:56.865Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5"
[2023-01-17T06:11:57.047Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c"
[2023-01-17T06:11:57.217Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_e592cfeded04fe8a928abaa278f"
[2023-01-17T06:11:57.374Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5"
[2023-01-17T06:11:57.552Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69"
[2023-01-17T06:11:57.744Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_b54d41b45616caa71b38f3d792f"
[2023-01-17T06:11:57.912Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_97e9454fcd0621a03478241d264"
[2023-01-17T06:11:58.081Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077"
[2023-01-17T06:11:58.244Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630"
[2023-01-17T06:11:58.424Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_8c8098e310faf4db4165474845e"
[2023-01-17T06:11:58.593Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_77b3f1846ed47c723c8525ca223"
[2023-01-17T06:11:58.752Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-17T06:11:58.910Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_73366372b46c005d3c1e472a3f8"
[2023-01-17T06:11:59.071Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78"
[2023-01-17T06:11:59.231Z][QUERY]: DROP INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user"
[2023-01-17T06:11:59.390Z][QUERY]: DROP INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user"
[2023-01-17T06:11:59.550Z][QUERY]: DROP TABLE "funding_users_user"
[2023-01-17T06:11:59.744Z][QUERY]: DROP INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject"
[2023-01-17T06:11:59.911Z][QUERY]: DROP INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject"
[2023-01-17T06:12:00.069Z][QUERY]: DROP TABLE "funding_subjects_subject"
[2023-01-17T06:12:00.231Z][QUERY]: DROP TABLE "template"
[2023-01-17T06:12:00.391Z][QUERY]: DROP INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction"
[2023-01-17T06:12:00.583Z][QUERY]: DROP INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction"
[2023-01-17T06:12:00.751Z][QUERY]: DROP INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction"
[2023-01-17T06:12:00.942Z][QUERY]: DROP INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction"
[2023-01-17T06:12:01.143Z][QUERY]: DROP TABLE "user_transaction"
[2023-01-17T06:12:01.311Z][QUERY]: DROP INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction"
[2023-01-17T06:12:01.471Z][QUERY]: DROP INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction"
[2023-01-17T06:12:01.704Z][QUERY]: DROP TABLE "funding_transaction"
[2023-01-17T06:12:01.872Z][QUERY]: DROP INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding"
[2023-01-17T06:12:02.064Z][QUERY]: DROP INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding"
[2023-01-17T06:12:02.231Z][QUERY]: DROP INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding"
[2023-01-17T06:12:02.423Z][QUERY]: DROP TABLE "funding"
[2023-01-17T06:12:02.592Z][QUERY]: DROP INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type"
[2023-01-17T06:12:02.750Z][QUERY]: DROP TABLE "funding_type"
[2023-01-17T06:12:02.910Z][QUERY]: DROP INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding"
[2023-01-17T06:12:03.071Z][QUERY]: DROP INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding"
[2023-01-17T06:12:03.230Z][QUERY]: DROP TABLE "student_in_funding"
[2023-01-17T06:12:03.392Z][QUERY]: DROP TABLE "req_instant"
[2023-01-17T06:12:03.549Z][QUERY]: DROP TABLE "status_log"
[2023-01-17T06:12:03.709Z][QUERY]: DROP INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson"
[2023-01-17T06:12:03.871Z][QUERY]: DROP TABLE "lesson"
[2023-01-17T06:12:04.057Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673934738831,"type":"bigint","params":[]},{"value":"lessonStatuslogTransaction1673934738831","type":"varchar","params":[]}]
[2023-01-17T06:12:04.263Z]Migration lessonStatuslogTransaction1673934738831 has been reverted successfully.
[2023-01-17T06:12:04.429Z][QUERY]: COMMIT
[2023-01-17T06:15:04.249Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-17T06:15:09.804Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-17T06:15:10.154Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-17T06:15:10.489Z]3 migrations are already loaded in the database.
[2023-01-17T06:15:10.489Z]4 migrations were found in the source code.
[2023-01-17T06:15:10.490Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-17T06:15:10.490Z]1 migrations are new migrations must be executed.
[2023-01-17T06:15:10.491Z][QUERY]: BEGIN TRANSACTION
[2023-01-17T06:15:10.827Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "reqInstantId" int NOT NULL, "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" uniqueidentifier NOT NULL CONSTRAINT "DF_303f1fb6efe9f8fc384916c3fb7" DEFAULT NEWSEQUENTIALID(), "tutorId" int NOT NULL, "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), CONSTRAINT "UQ_303f1fb6efe9f8fc384916c3fb7" UNIQUE ("channelGUID"), CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-17T06:15:11.030Z][QUERY]: CREATE UNIQUE INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson" ("reqInstantId") WHERE "reqInstantId" IS NOT NULL
[2023-01-17T06:15:11.226Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int, "lessonId" int, "fromState" int, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-17T06:15:11.425Z][QUERY]: CREATE TABLE "req_instant" ("id" int NOT NULL IDENTITY(1,1), "keyStageLevelId" int NOT NULL, "subjectId" int NOT NULL, "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_2af9af0405132ee54a51b387171" DEFAULT 10, "cost" int NOT NULL, "studentId" int NOT NULL, "tutorId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_10478adf2b6bdddeff5cc816e63" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_429fca86fb8c2a406ea6acb7fa5" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, CONSTRAINT "PK_0df0c7f86cd18ce417bcb764eab" PRIMARY KEY ("id"))
[2023-01-17T06:15:11.625Z][QUERY]: CREATE TABLE "student_in_funding" ("id" int NOT NULL IDENTITY(1,1), "studentId" int NOT NULL, "fundingId" int NOT NULL, "fundingAssigned" decimal(10,4) NOT NULL CONSTRAINT "DF_202265c09faad6ca0e62c05469a" DEFAULT 0, "fundingRemaining" decimal(10,4) NOT NULL CONSTRAINT "DF_8ffc82b9c4e37f4a511b5f47768" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_8ef4ab58fcadbf3c177d30d74cf" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_e23311139a698b3aad8151193e7" DEFAULT getUTCDate(), CONSTRAINT "PK_04a4ac0ca59cd474332d503e834" PRIMARY KEY ("id", "studentId", "fundingId"))
[2023-01-17T06:15:11.868Z][QUERY]: CREATE INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding" ("studentId") 
[2023-01-17T06:15:12.065Z][QUERY]: CREATE INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding" ("fundingId") 
[2023-01-17T06:15:12.227Z][QUERY]: CREATE TABLE "funding_type" ("id" int NOT NULL IDENTITY(1,1), "title" nvarchar(255) NOT NULL, CONSTRAINT "PK_9186aa2de0fecacc4270a171c72" PRIMARY KEY ("id"))
[2023-01-17T06:15:12.448Z][QUERY]: CREATE INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type" ("title") 
[2023-01-17T06:15:12.618Z][QUERY]: CREATE TABLE "funding" ("id" int NOT NULL IDENTITY(1,1), "stripeCustomerId" nvarchar(255), "numberOfAddedStudents" int NOT NULL CONSTRAINT "DF_c57e74a7c5b3317c9799737bb17" DEFAULT 0, "numberOfPendingStudents" int NOT NULL CONSTRAINT "DF_176c802cc15918cdca01f1b548b" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_652c617d0df737524e3822a4327" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_3208742513b8eeff356f9f43605" DEFAULT getUTCDate(), "fundingTypeId" int, "fundingOwnerUserId" int NOT NULL, "schoolId" int NOT NULL, CONSTRAINT "PK_096afc0d11a08deb52da61f039e" PRIMARY KEY ("id"))
[2023-01-17T06:15:12.787Z][QUERY]: CREATE INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding" ("fundingTypeId") 
[2023-01-17T06:15:12.951Z][QUERY]: CREATE INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding" ("fundingOwnerUserId") 
[2023-01-17T06:15:13.153Z][QUERY]: CREATE INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding" ("schoolId") 
[2023-01-17T06:15:13.320Z][QUERY]: CREATE TABLE "funding_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_fd623e7139f320060ebd9e8202f" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_2c3637c858eb677b8f925aefd2_ENUM CHECK(type IN ('FUNDING_TOPUP','ASSIGN_FUND')) NOT NULL, "schoolId" int NOT NULL, "fundingId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_2524a1448f39955d3c01f38a328" DEFAULT getUTCDate(), CONSTRAINT "PK_7b3e2baa3c95e783431e97bb75f" PRIMARY KEY ("id"))
[2023-01-17T06:15:13.488Z][QUERY]: CREATE INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction" ("schoolId") 
[2023-01-17T06:15:13.667Z][QUERY]: CREATE INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction" ("fundingId") 
[2023-01-17T06:15:13.840Z][QUERY]: CREATE TABLE "user_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_699ffce82f12a9f11d46796da48" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_760b65a581ec67dffeb38bb109_ENUM CHECK(type IN ('STUDENT_SELF_FUNDING_TOPUP','STUDENT_LESSON_FEE_PAY_SELF_FUNDING','STUDENT_LESSON_FEE_BACK_SELF_FUNDING','STUDENT_FUNDING_ASSIGN_FUND','STUDENT_LESSON_FEE_PAY_FUNDING','STUDENT_LESSON_FEE_BACK_FUNDING','PARENT_STUDENT_SELF_FUNDING_TOPUP','TUTOR_LESSON_EARN','TUTOR_WITHDRAW','SYSTEM_LESSON_SHARE')) NOT NULL, "userId" int NOT NULL, "lessonId" int, "fundingId" int, "studentUserId" int, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_70b2bdb02c290be0ec5ccf76bac" DEFAULT getUTCDate(), CONSTRAINT "PK_e36b77a5263ac0f191277c4c5d2" PRIMARY KEY ("id"))
[2023-01-17T06:15:14.017Z][QUERY]: CREATE INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction" ("userId") 
[2023-01-17T06:15:14.182Z][QUERY]: CREATE INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction" ("lessonId") 
[2023-01-17T06:15:14.427Z][QUERY]: CREATE INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction" ("fundingId") 
[2023-01-17T06:15:14.600Z][QUERY]: CREATE INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction" ("studentUserId") 
[2023-01-17T06:15:14.767Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-17T06:15:14.932Z][QUERY]: CREATE TABLE "funding_subjects_subject" ("fundingId" int NOT NULL, "subjectId" int NOT NULL, CONSTRAINT "PK_8ae7f8516810676bbbf751af142" PRIMARY KEY ("fundingId", "subjectId"))
[2023-01-17T06:15:15.105Z][QUERY]: CREATE INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject" ("fundingId") 
[2023-01-17T06:15:15.268Z][QUERY]: CREATE INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject" ("subjectId") 
[2023-01-17T06:15:15.436Z][QUERY]: CREATE TABLE "funding_users_user" ("fundingId" int NOT NULL, "userId" int NOT NULL, CONSTRAINT "PK_053ff2d5afb36e09b07caed95b1" PRIMARY KEY ("fundingId", "userId"))
[2023-01-17T06:15:15.602Z][QUERY]: CREATE INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user" ("fundingId") 
[2023-01-17T06:15:15.775Z][QUERY]: CREATE INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user" ("userId") 
[2023-01-17T06:15:15.940Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78" FOREIGN KEY ("reqInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:16.111Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:16.344Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:16.508Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:16.704Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_8c8098e310faf4db4165474845e" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:16.876Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:17.041Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:17.217Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_97e9454fcd0621a03478241d264" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:17.381Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_b54d41b45616caa71b38f3d792f" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:17.617Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE NO ACTION
[2023-01-17T06:15:17.791Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5" FOREIGN KEY ("fundingTypeId") REFERENCES "funding_type"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:17.957Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_e592cfeded04fe8a928abaa278f" FOREIGN KEY ("fundingOwnerUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:18.119Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:18.306Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:18.552Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:18.716Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_1422cc85c1642eed91e947cf877" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:18.908Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_67d6038132b6c74844c76541eb6" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:19.080Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_5acc35de62f727155b44c5077cc" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:19.245Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_26023533594b6104821aca7dcfb" FOREIGN KEY ("studentUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:15:19.415Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_eddf9d350e473527bd3b046df2e" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T06:15:19.638Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_4e1da5107fc718e03e363633a11" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T06:15:19.808Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T06:15:19.987Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_a458c11f312b6b23d68691b50c8" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T06:15:20.196Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673936009137,"type":"bigint","params":[]},{"value":"lessonStatuslogTransaction1673936009137","type":"varchar","params":[]}]
[2023-01-17T06:15:20.387Z]Migration lessonStatuslogTransaction1673936009137 has been executed successfully.
[2023-01-17T06:15:20.552Z][QUERY]: COMMIT
[2023-01-17T06:56:49.044Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-17T06:56:56.550Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-17T06:56:58.959Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-17T06:56:59.337Z]4 migrations are already loaded in the database.
[2023-01-17T06:56:59.337Z]lessonStatuslogTransaction1673936009137 is the last executed migration. It was executed on Tue Jan 17 2023 06:13:29 GMT+0000 (Coordinated Universal Time).
[2023-01-17T06:56:59.337Z]Now reverting it...
[2023-01-17T06:56:59.338Z][QUERY]: BEGIN TRANSACTION
[2023-01-17T06:56:59.683Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_a458c11f312b6b23d68691b50c8"
[2023-01-17T06:56:59.870Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3"
[2023-01-17T06:57:00.038Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_4e1da5107fc718e03e363633a11"
[2023-01-17T06:57:00.202Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_eddf9d350e473527bd3b046df2e"
[2023-01-17T06:57:00.371Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_26023533594b6104821aca7dcfb"
[2023-01-17T06:57:00.551Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_5acc35de62f727155b44c5077cc"
[2023-01-17T06:57:00.736Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_67d6038132b6c74844c76541eb6"
[2023-01-17T06:57:00.904Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_1422cc85c1642eed91e947cf877"
[2023-01-17T06:57:01.070Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8"
[2023-01-17T06:57:01.264Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5"
[2023-01-17T06:57:01.471Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c"
[2023-01-17T06:57:01.636Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_e592cfeded04fe8a928abaa278f"
[2023-01-17T06:57:03.185Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5"
[2023-01-17T06:57:03.793Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69"
[2023-01-17T06:57:03.975Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_b54d41b45616caa71b38f3d792f"
[2023-01-17T06:57:04.148Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_97e9454fcd0621a03478241d264"
[2023-01-17T06:57:04.317Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077"
[2023-01-17T06:57:04.498Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630"
[2023-01-17T06:57:04.677Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_8c8098e310faf4db4165474845e"
[2023-01-17T06:57:04.844Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_77b3f1846ed47c723c8525ca223"
[2023-01-17T06:57:05.011Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-17T06:57:05.217Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_73366372b46c005d3c1e472a3f8"
[2023-01-17T06:57:05.417Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78"
[2023-01-17T06:57:05.602Z][QUERY]: DROP INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user"
[2023-01-17T06:57:05.808Z][QUERY]: DROP INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user"
[2023-01-17T06:57:05.978Z][QUERY]: DROP TABLE "funding_users_user"
[2023-01-17T06:57:06.156Z][QUERY]: DROP INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject"
[2023-01-17T06:57:06.367Z][QUERY]: DROP INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject"
[2023-01-17T06:57:06.586Z][QUERY]: DROP TABLE "funding_subjects_subject"
[2023-01-17T06:57:06.776Z][QUERY]: DROP TABLE "template"
[2023-01-17T06:57:06.945Z][QUERY]: DROP INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction"
[2023-01-17T06:57:07.190Z][QUERY]: DROP INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction"
[2023-01-17T06:57:07.371Z][QUERY]: DROP INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction"
[2023-01-17T06:57:07.535Z][QUERY]: DROP INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction"
[2023-01-17T06:57:07.749Z][QUERY]: DROP TABLE "user_transaction"
[2023-01-17T06:57:07.915Z][QUERY]: DROP INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction"
[2023-01-17T06:57:08.088Z][QUERY]: DROP INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction"
[2023-01-17T06:57:08.283Z][QUERY]: DROP TABLE "funding_transaction"
[2023-01-17T06:57:08.448Z][QUERY]: DROP INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding"
[2023-01-17T06:57:08.611Z][QUERY]: DROP INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding"
[2023-01-17T06:57:08.768Z][QUERY]: DROP INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding"
[2023-01-17T06:57:08.934Z][QUERY]: DROP TABLE "funding"
[2023-01-17T06:57:09.097Z][QUERY]: DROP INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type"
[2023-01-17T06:57:11.270Z][QUERY]: DROP TABLE "funding_type"
[2023-01-17T06:57:11.435Z][QUERY]: DROP INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding"
[2023-01-17T06:57:11.617Z][QUERY]: DROP INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding"
[2023-01-17T06:57:11.783Z][QUERY]: DROP TABLE "student_in_funding"
[2023-01-17T06:57:11.965Z][QUERY]: DROP TABLE "req_instant"
[2023-01-17T06:57:12.133Z][QUERY]: DROP TABLE "status_log"
[2023-01-17T06:57:12.302Z][QUERY]: DROP INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson"
[2023-01-17T06:57:12.469Z][QUERY]: DROP TABLE "lesson"
[2023-01-17T06:57:12.651Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673936009137,"type":"bigint","params":[]},{"value":"lessonStatuslogTransaction1673936009137","type":"varchar","params":[]}]
[2023-01-17T06:57:12.830Z]Migration lessonStatuslogTransaction1673936009137 has been reverted successfully.
[2023-01-17T06:57:13.005Z][QUERY]: COMMIT
[2023-01-17T06:58:11.715Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-17T06:58:18.805Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-17T06:58:21.508Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-17T06:58:21.906Z]3 migrations are already loaded in the database.
[2023-01-17T06:58:21.907Z]4 migrations were found in the source code.
[2023-01-17T06:58:21.907Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-17T06:58:21.907Z]1 migrations are new migrations must be executed.
[2023-01-17T06:58:21.908Z][QUERY]: BEGIN TRANSACTION
[2023-01-17T06:58:22.261Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "reqInstantId" int NOT NULL, "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" uniqueidentifier NOT NULL CONSTRAINT "DF_303f1fb6efe9f8fc384916c3fb7" DEFAULT NEWSEQUENTIALID(), "tutorId" int NOT NULL, "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), CONSTRAINT "UQ_303f1fb6efe9f8fc384916c3fb7" UNIQUE ("channelGUID"), CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-17T06:58:22.608Z][QUERY]: CREATE UNIQUE INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson" ("reqInstantId") WHERE "reqInstantId" IS NOT NULL
[2023-01-17T06:58:22.784Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int, "lessonId" int, "fromState" int, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-17T06:58:22.963Z][QUERY]: CREATE TABLE "req_instant" ("id" int NOT NULL IDENTITY(1,1), "keyStageLevelId" int NOT NULL, "subjectId" int NOT NULL, "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_2af9af0405132ee54a51b387171" DEFAULT 10, "cost" int NOT NULL, "studentId" int NOT NULL, "tutorId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_10478adf2b6bdddeff5cc816e63" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_429fca86fb8c2a406ea6acb7fa5" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, CONSTRAINT "PK_0df0c7f86cd18ce417bcb764eab" PRIMARY KEY ("id"))
[2023-01-17T06:58:23.350Z][QUERY]: CREATE TABLE "student_in_funding" ("id" int NOT NULL IDENTITY(1,1), "studentId" int NOT NULL, "fundingId" int NOT NULL, "fundingAssigned" decimal(10,4) NOT NULL CONSTRAINT "DF_202265c09faad6ca0e62c05469a" DEFAULT 0, "fundingRemaining" decimal(10,4) NOT NULL CONSTRAINT "DF_8ffc82b9c4e37f4a511b5f47768" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_8ef4ab58fcadbf3c177d30d74cf" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_e23311139a698b3aad8151193e7" DEFAULT getUTCDate(), CONSTRAINT "PK_04a4ac0ca59cd474332d503e834" PRIMARY KEY ("id", "studentId", "fundingId"))
[2023-01-17T06:58:23.547Z][QUERY]: CREATE INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding" ("studentId") 
[2023-01-17T06:58:23.719Z][QUERY]: CREATE INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding" ("fundingId") 
[2023-01-17T06:58:23.886Z][QUERY]: CREATE TABLE "funding_type" ("id" int NOT NULL IDENTITY(1,1), "title" nvarchar(255) NOT NULL, CONSTRAINT "PK_9186aa2de0fecacc4270a171c72" PRIMARY KEY ("id"))
[2023-01-17T06:58:24.078Z][QUERY]: CREATE INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type" ("title") 
[2023-01-17T06:58:24.260Z][QUERY]: CREATE TABLE "funding" ("id" int NOT NULL IDENTITY(1,1), "stripeCustomerId" nvarchar(255), "numberOfAddedStudents" int NOT NULL CONSTRAINT "DF_c57e74a7c5b3317c9799737bb17" DEFAULT 0, "numberOfPendingStudents" int NOT NULL CONSTRAINT "DF_176c802cc15918cdca01f1b548b" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_652c617d0df737524e3822a4327" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_3208742513b8eeff356f9f43605" DEFAULT getUTCDate(), "fundingTypeId" int, "fundingOwnerUserId" int NOT NULL, "schoolId" int NOT NULL, CONSTRAINT "PK_096afc0d11a08deb52da61f039e" PRIMARY KEY ("id"))
[2023-01-17T06:58:24.483Z][QUERY]: CREATE INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding" ("fundingTypeId") 
[2023-01-17T06:58:24.669Z][QUERY]: CREATE INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding" ("fundingOwnerUserId") 
[2023-01-17T06:58:24.853Z][QUERY]: CREATE INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding" ("schoolId") 
[2023-01-17T06:58:25.025Z][QUERY]: CREATE TABLE "funding_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_fd623e7139f320060ebd9e8202f" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_2c3637c858eb677b8f925aefd2_ENUM CHECK(type IN ('FUNDING_TOPUP','ASSIGN_FUND')) NOT NULL, "schoolId" int NOT NULL, "fundingId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_2524a1448f39955d3c01f38a328" DEFAULT getUTCDate(), CONSTRAINT "PK_7b3e2baa3c95e783431e97bb75f" PRIMARY KEY ("id"))
[2023-01-17T06:58:25.236Z][QUERY]: CREATE INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction" ("schoolId") 
[2023-01-17T06:58:25.398Z][QUERY]: CREATE INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction" ("fundingId") 
[2023-01-17T06:58:25.647Z][QUERY]: CREATE TABLE "user_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_699ffce82f12a9f11d46796da48" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_760b65a581ec67dffeb38bb109_ENUM CHECK(type IN ('STUDENT_SELF_FUNDING_TOPUP','STUDENT_LESSON_FEE_PAY_SELF_FUNDING','STUDENT_LESSON_FEE_BACK_SELF_FUNDING','STUDENT_FUNDING_ASSIGN_FUND','STUDENT_LESSON_FEE_PAY_FUNDING','STUDENT_LESSON_FEE_BACK_FUNDING','PARENT_STUDENT_SELF_FUNDING_TOPUP','TUTOR_LESSON_EARN','TUTOR_WITHDRAW','SYSTEM_LESSON_SHARE')) NOT NULL, "userId" int NOT NULL, "lessonId" int, "fundingId" int, "studentUserId" int, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_70b2bdb02c290be0ec5ccf76bac" DEFAULT getUTCDate(), CONSTRAINT "PK_e36b77a5263ac0f191277c4c5d2" PRIMARY KEY ("id"))
[2023-01-17T06:58:27.327Z][QUERY]: CREATE INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction" ("userId") 
[2023-01-17T06:58:28.075Z][QUERY]: CREATE INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction" ("lessonId") 
[2023-01-17T06:58:28.252Z][QUERY]: CREATE INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction" ("fundingId") 
[2023-01-17T06:58:28.423Z][QUERY]: CREATE INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction" ("studentUserId") 
[2023-01-17T06:58:28.590Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-17T06:58:28.790Z][QUERY]: CREATE TABLE "funding_subjects_subject" ("fundingId" int NOT NULL, "subjectId" int NOT NULL, CONSTRAINT "PK_8ae7f8516810676bbbf751af142" PRIMARY KEY ("fundingId", "subjectId"))
[2023-01-17T06:58:28.956Z][QUERY]: CREATE INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject" ("fundingId") 
[2023-01-17T06:58:29.126Z][QUERY]: CREATE INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject" ("subjectId") 
[2023-01-17T06:58:29.292Z][QUERY]: CREATE TABLE "funding_users_user" ("fundingId" int NOT NULL, "userId" int NOT NULL, CONSTRAINT "PK_053ff2d5afb36e09b07caed95b1" PRIMARY KEY ("fundingId", "userId"))
[2023-01-17T06:58:30.799Z][QUERY]: CREATE INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user" ("fundingId") 
[2023-01-17T06:58:31.434Z][QUERY]: CREATE INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user" ("userId") 
[2023-01-17T06:58:31.600Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78" FOREIGN KEY ("reqInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:31.769Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:31.938Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:32.138Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:32.325Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_8c8098e310faf4db4165474845e" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:32.493Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:32.660Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:32.837Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_97e9454fcd0621a03478241d264" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:33.023Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_b54d41b45616caa71b38f3d792f" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:33.193Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE NO ACTION
[2023-01-17T06:58:33.617Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5" FOREIGN KEY ("fundingTypeId") REFERENCES "funding_type"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:33.802Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_e592cfeded04fe8a928abaa278f" FOREIGN KEY ("fundingOwnerUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:35.206Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:35.795Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:35.973Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:36.177Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_1422cc85c1642eed91e947cf877" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:36.345Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_67d6038132b6c74844c76541eb6" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:36.516Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_5acc35de62f727155b44c5077cc" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:36.689Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_26023533594b6104821aca7dcfb" FOREIGN KEY ("studentUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T06:58:36.865Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_eddf9d350e473527bd3b046df2e" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T06:58:37.051Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_4e1da5107fc718e03e363633a11" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T06:58:37.247Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T06:58:37.420Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_a458c11f312b6b23d68691b50c8" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T06:58:37.601Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673938652454,"type":"bigint","params":[]},{"value":"lessonStatuslogTransaction1673938652454","type":"varchar","params":[]}]
[2023-01-17T06:58:37.901Z]Migration lessonStatuslogTransaction1673938652454 has been executed successfully.
[2023-01-17T06:58:38.073Z][QUERY]: COMMIT
[2023-01-17T07:03:40.128Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-17T07:03:45.522Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-17T07:03:46.216Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-17T07:03:46.581Z]No migrations are pending
[2023-01-17T08:34:11.261Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-17T08:36:16.458Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-17T08:37:03.620Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-17T08:37:09.395Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-17T08:37:09.831Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-17T08:37:10.191Z]4 migrations are already loaded in the database.
[2023-01-17T08:37:10.242Z]lessonStatuslogTransaction1673938652454 is the last executed migration. It was executed on Tue Jan 17 2023 06:57:32 GMT+0000 (Coordinated Universal Time).
[2023-01-17T08:37:10.242Z]Now reverting it...
[2023-01-17T08:37:10.243Z][QUERY]: BEGIN TRANSACTION
[2023-01-17T08:37:10.613Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_a458c11f312b6b23d68691b50c8"
[2023-01-17T08:37:10.810Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3"
[2023-01-17T08:37:11.019Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_4e1da5107fc718e03e363633a11"
[2023-01-17T08:37:11.219Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_eddf9d350e473527bd3b046df2e"
[2023-01-17T08:37:11.410Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_26023533594b6104821aca7dcfb"
[2023-01-17T08:37:11.610Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_5acc35de62f727155b44c5077cc"
[2023-01-17T08:37:11.785Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_67d6038132b6c74844c76541eb6"
[2023-01-17T08:37:12.090Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_1422cc85c1642eed91e947cf877"
[2023-01-17T08:37:12.280Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8"
[2023-01-17T08:37:12.498Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5"
[2023-01-17T08:37:12.849Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c"
[2023-01-17T08:37:13.026Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_e592cfeded04fe8a928abaa278f"
[2023-01-17T08:37:13.209Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5"
[2023-01-17T08:37:13.490Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69"
[2023-01-17T08:37:13.689Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_b54d41b45616caa71b38f3d792f"
[2023-01-17T08:37:13.898Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_97e9454fcd0621a03478241d264"
[2023-01-17T08:37:14.100Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077"
[2023-01-17T08:37:14.289Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630"
[2023-01-17T08:37:14.459Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_8c8098e310faf4db4165474845e"
[2023-01-17T08:37:14.646Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_77b3f1846ed47c723c8525ca223"
[2023-01-17T08:37:14.815Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-17T08:37:14.977Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_73366372b46c005d3c1e472a3f8"
[2023-01-17T08:37:15.177Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78"
[2023-01-17T08:37:15.370Z][QUERY]: DROP INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user"
[2023-01-17T08:37:15.569Z][QUERY]: DROP INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user"
[2023-01-17T08:37:15.739Z][QUERY]: DROP TABLE "funding_users_user"
[2023-01-17T08:37:15.929Z][QUERY]: DROP INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject"
[2023-01-17T08:37:16.130Z][QUERY]: DROP INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject"
[2023-01-17T08:37:16.308Z][QUERY]: DROP TABLE "funding_subjects_subject"
[2023-01-17T08:37:16.489Z][QUERY]: DROP TABLE "template"
[2023-01-17T08:37:16.659Z][QUERY]: DROP INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction"
[2023-01-17T08:37:16.851Z][QUERY]: DROP INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction"
[2023-01-17T08:37:17.054Z][QUERY]: DROP INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction"
[2023-01-17T08:37:17.251Z][QUERY]: DROP INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction"
[2023-01-17T08:37:17.450Z][QUERY]: DROP TABLE "user_transaction"
[2023-01-17T08:37:17.649Z][QUERY]: DROP INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction"
[2023-01-17T08:37:17.817Z][QUERY]: DROP INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction"
[2023-01-17T08:37:18.090Z][QUERY]: DROP TABLE "funding_transaction"
[2023-01-17T08:37:18.290Z][QUERY]: DROP INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding"
[2023-01-17T08:37:18.466Z][QUERY]: DROP INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding"
[2023-01-17T08:37:18.651Z][QUERY]: DROP INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding"
[2023-01-17T08:37:18.816Z][QUERY]: DROP TABLE "funding"
[2023-01-17T08:37:19.018Z][QUERY]: DROP INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type"
[2023-01-17T08:37:19.209Z][QUERY]: DROP TABLE "funding_type"
[2023-01-17T08:37:19.409Z][QUERY]: DROP INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding"
[2023-01-17T08:37:19.577Z][QUERY]: DROP INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding"
[2023-01-17T08:37:19.769Z][QUERY]: DROP TABLE "student_in_funding"
[2023-01-17T08:37:19.970Z][QUERY]: DROP TABLE "req_instant"
[2023-01-17T08:37:20.170Z][QUERY]: DROP TABLE "status_log"
[2023-01-17T08:37:20.339Z][QUERY]: DROP INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson"
[2023-01-17T08:37:20.535Z][QUERY]: DROP TABLE "lesson"
[2023-01-17T08:37:20.732Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673938652454,"type":"bigint","params":[]},{"value":"lessonStatuslogTransaction1673938652454","type":"varchar","params":[]}]
[2023-01-17T08:37:20.896Z]Migration lessonStatuslogTransaction1673938652454 has been reverted successfully.
[2023-01-17T08:37:21.134Z][QUERY]: COMMIT
[2023-01-17T08:38:43.903Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-17T08:38:49.868Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-17T08:38:50.267Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-17T08:38:50.696Z]3 migrations are already loaded in the database.
[2023-01-17T08:38:50.696Z]4 migrations were found in the source code.
[2023-01-17T08:38:50.697Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-17T08:38:50.697Z]1 migrations are new migrations must be executed.
[2023-01-17T08:38:50.698Z][QUERY]: BEGIN TRANSACTION
[2023-01-17T08:38:51.047Z][QUERY]: CREATE TABLE "registration" ("id" int NOT NULL IDENTITY(1,1), "status" int CONSTRAINT CHK_96316c742ce2bd66353ab7b07d_ENUM CHECK(status IN ('1000','1001','1002','1003','1004','1005','1006','1007','1008','1009')) NOT NULL CONSTRAINT "DF_fecec899bc9d9ae757d4ebe8dd8" DEFAULT 1000, "studentId" int NOT NULL, "lessonId" int NOT NULL, "studentUserId" int NOT NULL, "studentToken" nvarchar(255), "isMute" bit NOT NULL CONSTRAINT "DF_39da412b409076e680ef973080c" DEFAULT 1, "joinedAt" datetime, "isBlocked" bit NOT NULL CONSTRAINT "DF_a16afc47693be8131c077db3b05" DEFAULT 0, "prepaidCost" decimal(10,4) NOT NULL, "realCost" decimal(10,4), "createdAt" datetime2 NOT NULL CONSTRAINT "DF_011f469e9cded90d8fdd26e0e50" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_6f92f5257e587881ec2e66be08f" DEFAULT getUTCDate(), CONSTRAINT "PK_a1c83caeace68f354c801807577" PRIMARY KEY ("id", "lessonId"))
[2023-01-17T08:38:51.219Z][QUERY]: CREATE INDEX "IDX_787e37bb3fc13bb16580a67a3d" ON "registration" ("lessonId") 
[2023-01-17T08:38:51.412Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int, "lessonId" int, "fromState" int, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-17T08:38:51.590Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "reqInstantId" int NOT NULL, "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" uniqueidentifier NOT NULL CONSTRAINT "DF_303f1fb6efe9f8fc384916c3fb7" DEFAULT NEWSEQUENTIALID(), "tutorId" int NOT NULL, "tutorUserId" int NOT NULL, "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), "subjectId" int, "keyStageLevelId" int, CONSTRAINT "UQ_303f1fb6efe9f8fc384916c3fb7" UNIQUE ("channelGUID"), CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-17T08:38:51.789Z][QUERY]: CREATE INDEX "IDX_cd8274b3e5c420f57a14e9b695" ON "lesson" ("subjectId") 
[2023-01-17T08:38:51.970Z][QUERY]: CREATE INDEX "IDX_d7e16e7104db61867db479e6fa" ON "lesson" ("keyStageLevelId") 
[2023-01-17T08:38:52.171Z][QUERY]: CREATE UNIQUE INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson" ("reqInstantId") WHERE "reqInstantId" IS NOT NULL
[2023-01-17T08:38:52.370Z][QUERY]: CREATE TABLE "req_instant" ("id" int NOT NULL IDENTITY(1,1), "keyStageLevelId" int NOT NULL, "subjectId" int NOT NULL, "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_2af9af0405132ee54a51b387171" DEFAULT 10, "cost" int NOT NULL, "studentId" int NOT NULL, "tutorId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_10478adf2b6bdddeff5cc816e63" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_429fca86fb8c2a406ea6acb7fa5" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, CONSTRAINT "PK_0df0c7f86cd18ce417bcb764eab" PRIMARY KEY ("id"))
[2023-01-17T08:38:52.610Z][QUERY]: CREATE TABLE "student_in_funding" ("id" int NOT NULL IDENTITY(1,1), "studentId" int NOT NULL, "fundingId" int NOT NULL, "fundingAssigned" decimal(10,4) NOT NULL CONSTRAINT "DF_202265c09faad6ca0e62c05469a" DEFAULT 0, "fundingRemaining" decimal(10,4) NOT NULL CONSTRAINT "DF_8ffc82b9c4e37f4a511b5f47768" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_8ef4ab58fcadbf3c177d30d74cf" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_e23311139a698b3aad8151193e7" DEFAULT getUTCDate(), CONSTRAINT "PK_04a4ac0ca59cd474332d503e834" PRIMARY KEY ("id", "studentId", "fundingId"))
[2023-01-17T08:38:52.811Z][QUERY]: CREATE INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding" ("studentId") 
[2023-01-17T08:38:53.012Z][QUERY]: CREATE INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding" ("fundingId") 
[2023-01-17T08:38:53.249Z][QUERY]: CREATE TABLE "funding_type" ("id" int NOT NULL IDENTITY(1,1), "title" nvarchar(255) NOT NULL, CONSTRAINT "PK_9186aa2de0fecacc4270a171c72" PRIMARY KEY ("id"))
[2023-01-17T08:38:53.414Z][QUERY]: CREATE INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type" ("title") 
[2023-01-17T08:38:53.574Z][QUERY]: CREATE TABLE "funding" ("id" int NOT NULL IDENTITY(1,1), "stripeCustomerId" nvarchar(255), "numberOfAddedStudents" int NOT NULL CONSTRAINT "DF_c57e74a7c5b3317c9799737bb17" DEFAULT 0, "numberOfPendingStudents" int NOT NULL CONSTRAINT "DF_176c802cc15918cdca01f1b548b" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_652c617d0df737524e3822a4327" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_3208742513b8eeff356f9f43605" DEFAULT getUTCDate(), "fundingTypeId" int, "fundingOwnerUserId" int NOT NULL, "schoolId" int NOT NULL, CONSTRAINT "PK_096afc0d11a08deb52da61f039e" PRIMARY KEY ("id"))
[2023-01-17T08:38:53.736Z][QUERY]: CREATE INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding" ("fundingTypeId") 
[2023-01-17T08:38:54.153Z][QUERY]: CREATE INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding" ("fundingOwnerUserId") 
[2023-01-17T08:38:54.332Z][QUERY]: CREATE INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding" ("schoolId") 
[2023-01-17T08:38:54.529Z][QUERY]: CREATE TABLE "funding_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_fd623e7139f320060ebd9e8202f" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_2c3637c858eb677b8f925aefd2_ENUM CHECK(type IN ('FUNDING_TOPUP','ASSIGN_FUND')) NOT NULL, "schoolId" int NOT NULL, "fundingId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_2524a1448f39955d3c01f38a328" DEFAULT getUTCDate(), CONSTRAINT "PK_7b3e2baa3c95e783431e97bb75f" PRIMARY KEY ("id"))
[2023-01-17T08:38:54.696Z][QUERY]: CREATE INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction" ("schoolId") 
[2023-01-17T08:38:54.856Z][QUERY]: CREATE INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction" ("fundingId") 
[2023-01-17T08:38:55.050Z][QUERY]: CREATE TABLE "user_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_699ffce82f12a9f11d46796da48" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_760b65a581ec67dffeb38bb109_ENUM CHECK(type IN ('STUDENT_SELF_FUNDING_TOPUP','STUDENT_LESSON_FEE_PAY_SELF_FUNDING','STUDENT_LESSON_FEE_BACK_SELF_FUNDING','STUDENT_FUNDING_ASSIGN_FUND','STUDENT_LESSON_FEE_PAY_FUNDING','STUDENT_LESSON_FEE_BACK_FUNDING','PARENT_STUDENT_SELF_FUNDING_TOPUP','TUTOR_LESSON_EARN','TUTOR_WITHDRAW','SYSTEM_LESSON_SHARE')) NOT NULL, "userId" int NOT NULL, "lessonId" int, "fundingId" int, "studentUserId" int, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_70b2bdb02c290be0ec5ccf76bac" DEFAULT getUTCDate(), CONSTRAINT "PK_e36b77a5263ac0f191277c4c5d2" PRIMARY KEY ("id"))
[2023-01-17T08:38:55.220Z][QUERY]: CREATE INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction" ("userId") 
[2023-01-17T08:38:55.497Z][QUERY]: CREATE INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction" ("lessonId") 
[2023-01-17T08:38:55.786Z][QUERY]: CREATE INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction" ("fundingId") 
[2023-01-17T08:38:55.963Z][QUERY]: CREATE INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction" ("studentUserId") 
[2023-01-17T08:38:56.132Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-17T08:38:56.311Z][QUERY]: CREATE TABLE "funding_subjects_subject" ("fundingId" int NOT NULL, "subjectId" int NOT NULL, CONSTRAINT "PK_8ae7f8516810676bbbf751af142" PRIMARY KEY ("fundingId", "subjectId"))
[2023-01-17T08:38:56.475Z][QUERY]: CREATE INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject" ("fundingId") 
[2023-01-17T08:38:56.652Z][QUERY]: CREATE INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject" ("subjectId") 
[2023-01-17T08:38:56.813Z][QUERY]: CREATE TABLE "funding_users_user" ("fundingId" int NOT NULL, "userId" int NOT NULL, CONSTRAINT "PK_053ff2d5afb36e09b07caed95b1" PRIMARY KEY ("fundingId", "userId"))
[2023-01-17T08:38:57.091Z][QUERY]: CREATE INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user" ("fundingId") 
[2023-01-17T08:38:57.251Z][QUERY]: CREATE INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user" ("userId") 
[2023-01-17T08:38:57.415Z][QUERY]: ALTER TABLE "registration" ADD CONSTRAINT "FK_6c992d9c3648892e1b553fb12ce" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:38:57.609Z][QUERY]: ALTER TABLE "registration" ADD CONSTRAINT "FK_787e37bb3fc13bb16580a67a3d3" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE CASCADE ON UPDATE NO ACTION
[2023-01-17T08:38:57.774Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:38:57.938Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:38:58.112Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78" FOREIGN KEY ("reqInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:38:58.289Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:38:58.455Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_abf5442bda498bff637a09d2d61" FOREIGN KEY ("tutorUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:38:58.731Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_cd8274b3e5c420f57a14e9b6950" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:38:59.050Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_d7e16e7104db61867db479e6fa7" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:38:59.214Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_8c8098e310faf4db4165474845e" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:38:59.385Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:38:59.649Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:38:59.825Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_97e9454fcd0621a03478241d264" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:39:00.003Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_b54d41b45616caa71b38f3d792f" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:39:00.167Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE NO ACTION
[2023-01-17T08:39:00.334Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5" FOREIGN KEY ("fundingTypeId") REFERENCES "funding_type"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:39:00.489Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_e592cfeded04fe8a928abaa278f" FOREIGN KEY ("fundingOwnerUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:39:00.654Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:39:00.814Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:39:00.987Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:39:01.157Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_1422cc85c1642eed91e947cf877" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:39:01.331Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_67d6038132b6c74844c76541eb6" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:39:01.571Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_5acc35de62f727155b44c5077cc" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:39:01.770Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_26023533594b6104821aca7dcfb" FOREIGN KEY ("studentUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-17T08:39:01.943Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_eddf9d350e473527bd3b046df2e" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T08:39:02.145Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_4e1da5107fc718e03e363633a11" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T08:39:02.334Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T08:39:02.496Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_a458c11f312b6b23d68691b50c8" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-17T08:39:02.695Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1673944689371,"type":"bigint","params":[]},{"value":"lessonStatuslogTransactionRegistration1673944689371","type":"varchar","params":[]}]
[2023-01-17T08:39:02.898Z]Migration lessonStatuslogTransactionRegistration1673944689371 has been executed successfully.
[2023-01-17T08:39:03.083Z][QUERY]: COMMIT
[2023-01-20T18:16:19.787Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-20T18:16:28.179Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-20T18:16:28.565Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-20T18:16:28.912Z]4 migrations are already loaded in the database.
[2023-01-20T18:16:28.932Z]lessonStatuslogTransactionRegistration1673944689371 is the last executed migration. It was executed on Tue Jan 17 2023 08:38:09 GMT+0000 (Coordinated Universal Time).
[2023-01-20T18:16:28.932Z]Now reverting it...
[2023-01-20T18:16:28.933Z][QUERY]: BEGIN TRANSACTION
[2023-01-20T18:16:29.236Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_a458c11f312b6b23d68691b50c8"
[2023-01-20T18:16:29.403Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3"
[2023-01-20T18:16:29.566Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_4e1da5107fc718e03e363633a11"
[2023-01-20T18:16:29.725Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_eddf9d350e473527bd3b046df2e"
[2023-01-20T18:16:29.884Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_26023533594b6104821aca7dcfb"
[2023-01-20T18:16:30.068Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_5acc35de62f727155b44c5077cc"
[2023-01-20T18:16:30.231Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_67d6038132b6c74844c76541eb6"
[2023-01-20T18:16:30.389Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_1422cc85c1642eed91e947cf877"
[2023-01-20T18:16:30.549Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8"
[2023-01-20T18:16:30.716Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5"
[2023-01-20T18:16:30.875Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c"
[2023-01-20T18:16:31.036Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_e592cfeded04fe8a928abaa278f"
[2023-01-20T18:16:31.201Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5"
[2023-01-20T18:16:31.362Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69"
[2023-01-20T18:16:31.521Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_b54d41b45616caa71b38f3d792f"
[2023-01-20T18:16:31.681Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_97e9454fcd0621a03478241d264"
[2023-01-20T18:16:31.840Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077"
[2023-01-20T18:16:32.000Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630"
[2023-01-20T18:16:32.163Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_8c8098e310faf4db4165474845e"
[2023-01-20T18:16:32.326Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_d7e16e7104db61867db479e6fa7"
[2023-01-20T18:16:32.486Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_cd8274b3e5c420f57a14e9b6950"
[2023-01-20T18:16:32.644Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_abf5442bda498bff637a09d2d61"
[2023-01-20T18:16:32.807Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_73366372b46c005d3c1e472a3f8"
[2023-01-20T18:16:32.966Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78"
[2023-01-20T18:16:33.126Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_77b3f1846ed47c723c8525ca223"
[2023-01-20T18:16:33.288Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-20T18:16:33.451Z][QUERY]: ALTER TABLE "registration" DROP CONSTRAINT "FK_787e37bb3fc13bb16580a67a3d3"
[2023-01-20T18:16:33.621Z][QUERY]: ALTER TABLE "registration" DROP CONSTRAINT "FK_6c992d9c3648892e1b553fb12ce"
[2023-01-20T18:16:34.151Z][QUERY]: DROP INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user"
[2023-01-20T18:16:34.311Z][QUERY]: DROP INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user"
[2023-01-20T18:16:34.471Z][QUERY]: DROP TABLE "funding_users_user"
[2023-01-20T18:16:34.628Z][QUERY]: DROP INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject"
[2023-01-20T18:16:34.800Z][QUERY]: DROP INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject"
[2023-01-20T18:16:34.969Z][QUERY]: DROP TABLE "funding_subjects_subject"
[2023-01-20T18:16:35.133Z][QUERY]: DROP TABLE "template"
[2023-01-20T18:16:35.294Z][QUERY]: DROP INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction"
[2023-01-20T18:16:35.464Z][QUERY]: DROP INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction"
[2023-01-20T18:16:35.628Z][QUERY]: DROP INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction"
[2023-01-20T18:16:35.790Z][QUERY]: DROP INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction"
[2023-01-20T18:16:35.950Z][QUERY]: DROP TABLE "user_transaction"
[2023-01-20T18:16:36.115Z][QUERY]: DROP INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction"
[2023-01-20T18:16:36.279Z][QUERY]: DROP INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction"
[2023-01-20T18:16:36.438Z][QUERY]: DROP TABLE "funding_transaction"
[2023-01-20T18:16:36.604Z][QUERY]: DROP INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding"
[2023-01-20T18:16:36.761Z][QUERY]: DROP INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding"
[2023-01-20T18:16:36.922Z][QUERY]: DROP INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding"
[2023-01-20T18:16:37.079Z][QUERY]: DROP TABLE "funding"
[2023-01-20T18:16:37.239Z][QUERY]: DROP INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type"
[2023-01-20T18:16:37.399Z][QUERY]: DROP TABLE "funding_type"
[2023-01-20T18:16:37.561Z][QUERY]: DROP INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding"
[2023-01-20T18:16:37.750Z][QUERY]: DROP INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding"
[2023-01-20T18:16:37.912Z][QUERY]: DROP TABLE "student_in_funding"
[2023-01-20T18:16:38.084Z][QUERY]: DROP TABLE "req_instant"
[2023-01-20T18:16:38.255Z][QUERY]: DROP INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson"
[2023-01-20T18:16:38.429Z][QUERY]: DROP INDEX "IDX_d7e16e7104db61867db479e6fa" ON "lesson"
[2023-01-20T18:16:38.592Z][QUERY]: DROP INDEX "IDX_cd8274b3e5c420f57a14e9b695" ON "lesson"
[2023-01-20T18:16:38.746Z][QUERY]: DROP TABLE "lesson"
[2023-01-20T18:16:38.953Z][QUERY]: DROP TABLE "status_log"
[2023-01-20T18:16:39.107Z][QUERY]: DROP INDEX "IDX_787e37bb3fc13bb16580a67a3d" ON "registration"
[2023-01-20T18:16:39.266Z][QUERY]: DROP TABLE "registration"
[2023-01-20T18:16:39.425Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1673944689371,"type":"bigint","params":[]},{"value":"lessonStatuslogTransactionRegistration1673944689371","type":"varchar","params":[]}]
[2023-01-20T18:16:39.597Z]Migration lessonStatuslogTransactionRegistration1673944689371 has been reverted successfully.
[2023-01-20T18:16:39.776Z][QUERY]: COMMIT
[2023-01-20T18:18:38.302Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-20T18:18:43.214Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-20T18:18:43.533Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-20T18:18:43.857Z]3 migrations are already loaded in the database.
[2023-01-20T18:18:43.857Z]4 migrations were found in the source code.
[2023-01-20T18:18:43.857Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-20T18:18:43.857Z]1 migrations are new migrations must be executed.
[2023-01-20T18:18:43.859Z][QUERY]: BEGIN TRANSACTION
[2023-01-20T18:18:44.217Z][QUERY]: CREATE TABLE "registration" ("id" int NOT NULL IDENTITY(1,1), "status" int CONSTRAINT CHK_96316c742ce2bd66353ab7b07d_ENUM CHECK(status IN ('1000','1001','1002','1003','1004','1005','1006','1007','1008','1009')) NOT NULL CONSTRAINT "DF_fecec899bc9d9ae757d4ebe8dd8" DEFAULT 1000, "studentId" int NOT NULL, "lessonId" int NOT NULL, "studentUserId" int NOT NULL, "studentToken" nvarchar(255), "isMute" bit NOT NULL CONSTRAINT "DF_39da412b409076e680ef973080c" DEFAULT 1, "joinedAt" datetime, "isBlocked" bit NOT NULL CONSTRAINT "DF_a16afc47693be8131c077db3b05" DEFAULT 0, "prepaidCost" decimal(10,4) NOT NULL, "realCost" decimal(10,4), "createdAt" datetime2 NOT NULL CONSTRAINT "DF_011f469e9cded90d8fdd26e0e50" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_6f92f5257e587881ec2e66be08f" DEFAULT getUTCDate(), CONSTRAINT "PK_a1c83caeace68f354c801807577" PRIMARY KEY ("id", "lessonId"))
[2023-01-20T18:18:44.411Z][QUERY]: CREATE INDEX "IDX_787e37bb3fc13bb16580a67a3d" ON "registration" ("lessonId") 
[2023-01-20T18:18:44.572Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int, "lessonId" int, "fromState" int, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-20T18:18:44.740Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "reqInstantId" int NOT NULL, "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" uniqueidentifier NOT NULL CONSTRAINT "DF_303f1fb6efe9f8fc384916c3fb7" DEFAULT NEWSEQUENTIALID(), "tutorId" int NOT NULL, "tutorUserId" int NOT NULL, "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), "subjectId" int, "keyStageLevelId" int, CONSTRAINT "UQ_303f1fb6efe9f8fc384916c3fb7" UNIQUE ("channelGUID"), CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-20T18:18:44.903Z][QUERY]: CREATE INDEX "IDX_cd8274b3e5c420f57a14e9b695" ON "lesson" ("subjectId") 
[2023-01-20T18:18:45.063Z][QUERY]: CREATE INDEX "IDX_d7e16e7104db61867db479e6fa" ON "lesson" ("keyStageLevelId") 
[2023-01-20T18:18:45.226Z][QUERY]: CREATE UNIQUE INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson" ("reqInstantId") WHERE "reqInstantId" IS NOT NULL
[2023-01-20T18:18:45.383Z][QUERY]: CREATE TABLE "req_instant" ("id" int NOT NULL IDENTITY(1,1), "keyStageLevelId" int NOT NULL, "subjectId" int NOT NULL, "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_2af9af0405132ee54a51b387171" DEFAULT 10, "cost" int NOT NULL, "studentId" int NOT NULL, "tutorId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_10478adf2b6bdddeff5cc816e63" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_429fca86fb8c2a406ea6acb7fa5" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, CONSTRAINT "PK_0df0c7f86cd18ce417bcb764eab" PRIMARY KEY ("id"))
[2023-01-20T18:18:45.565Z][QUERY]: CREATE TABLE "student_in_funding" ("id" int NOT NULL IDENTITY(1,1), "studentId" int NOT NULL, "fundingId" int NOT NULL, "fundingAssigned" decimal(10,4) NOT NULL CONSTRAINT "DF_202265c09faad6ca0e62c05469a" DEFAULT 0, "fundingRemaining" decimal(10,4) NOT NULL CONSTRAINT "DF_8ffc82b9c4e37f4a511b5f47768" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_8ef4ab58fcadbf3c177d30d74cf" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_e23311139a698b3aad8151193e7" DEFAULT getUTCDate(), CONSTRAINT "PK_04a4ac0ca59cd474332d503e834" PRIMARY KEY ("id", "studentId", "fundingId"))
[2023-01-20T18:18:45.736Z][QUERY]: CREATE INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding" ("studentId") 
[2023-01-20T18:18:45.892Z][QUERY]: CREATE INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding" ("fundingId") 
[2023-01-20T18:18:46.073Z][QUERY]: CREATE TABLE "funding_type" ("id" int NOT NULL IDENTITY(1,1), "title" nvarchar(255) NOT NULL, CONSTRAINT "PK_9186aa2de0fecacc4270a171c72" PRIMARY KEY ("id"))
[2023-01-20T18:18:46.235Z][QUERY]: CREATE INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type" ("title") 
[2023-01-20T18:18:46.392Z][QUERY]: CREATE TABLE "funding" ("id" int NOT NULL IDENTITY(1,1), "stripeCustomerId" nvarchar(255), "numberOfAddedStudents" int NOT NULL CONSTRAINT "DF_c57e74a7c5b3317c9799737bb17" DEFAULT 0, "numberOfPendingStudents" int NOT NULL CONSTRAINT "DF_176c802cc15918cdca01f1b548b" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_652c617d0df737524e3822a4327" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_3208742513b8eeff356f9f43605" DEFAULT getUTCDate(), "fundingTypeId" int, "fundingOwnerUserId" int NOT NULL, "schoolId" int NOT NULL, CONSTRAINT "PK_096afc0d11a08deb52da61f039e" PRIMARY KEY ("id"))
[2023-01-20T18:18:46.557Z][QUERY]: CREATE INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding" ("fundingTypeId") 
[2023-01-20T18:18:46.753Z][QUERY]: CREATE INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding" ("fundingOwnerUserId") 
[2023-01-20T18:18:46.986Z][QUERY]: CREATE INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding" ("schoolId") 
[2023-01-20T18:18:47.147Z][QUERY]: CREATE TABLE "funding_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_fd623e7139f320060ebd9e8202f" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_2c3637c858eb677b8f925aefd2_ENUM CHECK(type IN ('FUNDING_TOPUP','ASSIGN_FUND')) NOT NULL, "schoolId" int NOT NULL, "fundingId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_2524a1448f39955d3c01f38a328" DEFAULT getUTCDate(), CONSTRAINT "PK_7b3e2baa3c95e783431e97bb75f" PRIMARY KEY ("id"))
[2023-01-20T18:18:47.313Z][QUERY]: CREATE INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction" ("schoolId") 
[2023-01-20T18:18:47.474Z][QUERY]: CREATE INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction" ("fundingId") 
[2023-01-20T18:18:47.637Z][QUERY]: CREATE TABLE "user_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_699ffce82f12a9f11d46796da48" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_760b65a581ec67dffeb38bb109_ENUM CHECK(type IN ('STUDENT_SELF_FUNDING_TOPUP','STUDENT_LESSON_FEE_PAY_SELF_FUNDING','STUDENT_LESSON_FEE_BACK_SELF_FUNDING','STUDENT_FUNDING_ASSIGN_FUND','STUDENT_LESSON_FEE_PAY_FUNDING','STUDENT_LESSON_FEE_BACK_FUNDING','PARENT_STUDENT_SELF_FUNDING_TOPUP','TUTOR_LESSON_EARN','TUTOR_WITHDRAW','SYSTEM_LESSON_SHARE')) NOT NULL, "userId" int NOT NULL, "lessonId" int, "fundingId" int, "studentUserId" int, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_70b2bdb02c290be0ec5ccf76bac" DEFAULT getUTCDate(), CONSTRAINT "PK_e36b77a5263ac0f191277c4c5d2" PRIMARY KEY ("id"))
[2023-01-20T18:18:47.818Z][QUERY]: CREATE INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction" ("userId") 
[2023-01-20T18:18:47.977Z][QUERY]: CREATE INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction" ("lessonId") 
[2023-01-20T18:18:48.135Z][QUERY]: CREATE INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction" ("fundingId") 
[2023-01-20T18:18:48.292Z][QUERY]: CREATE INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction" ("studentUserId") 
[2023-01-20T18:18:48.452Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-20T18:18:48.608Z][QUERY]: CREATE TABLE "funding_subjects_subject" ("fundingId" int NOT NULL, "subjectId" int NOT NULL, CONSTRAINT "PK_8ae7f8516810676bbbf751af142" PRIMARY KEY ("fundingId", "subjectId"))
[2023-01-20T18:18:48.769Z][QUERY]: CREATE INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject" ("fundingId") 
[2023-01-20T18:18:48.929Z][QUERY]: CREATE INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject" ("subjectId") 
[2023-01-20T18:18:49.092Z][QUERY]: CREATE TABLE "funding_users_user" ("fundingId" int NOT NULL, "userId" int NOT NULL, CONSTRAINT "PK_053ff2d5afb36e09b07caed95b1" PRIMARY KEY ("fundingId", "userId"))
[2023-01-20T18:18:49.269Z][QUERY]: CREATE INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user" ("fundingId") 
[2023-01-20T18:18:49.459Z][QUERY]: CREATE INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user" ("userId") 
[2023-01-20T18:18:49.618Z][QUERY]: ALTER TABLE "registration" ADD CONSTRAINT "FK_6c992d9c3648892e1b553fb12ce" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:49.779Z][QUERY]: ALTER TABLE "registration" ADD CONSTRAINT "FK_787e37bb3fc13bb16580a67a3d3" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE CASCADE ON UPDATE NO ACTION
[2023-01-20T18:18:49.938Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:50.098Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:50.260Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78" FOREIGN KEY ("reqInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:50.419Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:50.583Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_abf5442bda498bff637a09d2d61" FOREIGN KEY ("tutorUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:50.885Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_cd8274b3e5c420f57a14e9b6950" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:51.054Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_d7e16e7104db61867db479e6fa7" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:51.215Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_8c8098e310faf4db4165474845e" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:51.376Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:51.554Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:51.723Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_97e9454fcd0621a03478241d264" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:51.953Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_b54d41b45616caa71b38f3d792f" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:52.116Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE NO ACTION
[2023-01-20T18:18:52.274Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5" FOREIGN KEY ("fundingTypeId") REFERENCES "funding_type"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:52.432Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_e592cfeded04fe8a928abaa278f" FOREIGN KEY ("fundingOwnerUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:52.598Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:52.759Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:52.920Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:53.078Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_1422cc85c1642eed91e947cf877" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:53.238Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_67d6038132b6c74844c76541eb6" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:53.415Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_5acc35de62f727155b44c5077cc" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:53.575Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_26023533594b6104821aca7dcfb" FOREIGN KEY ("studentUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-20T18:18:53.741Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_eddf9d350e473527bd3b046df2e" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-20T18:18:53.914Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_4e1da5107fc718e03e363633a11" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-20T18:18:54.073Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-20T18:18:54.242Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_a458c11f312b6b23d68691b50c8" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-20T18:18:54.405Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1674238685687,"type":"bigint","params":[]},{"value":"lessonStatuslogTransactionRegistration1674238685687","type":"varchar","params":[]}]
[2023-01-20T18:18:54.564Z]Migration lessonStatuslogTransactionRegistration1674238685687 has been executed successfully.
[2023-01-20T18:18:54.721Z][QUERY]: COMMIT
[2023-01-24T17:50:32.720Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-24T17:50:39.860Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-24T17:50:40.182Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-24T17:50:40.469Z]4 migrations are already loaded in the database.
[2023-01-24T17:50:40.497Z]lessonStatuslogTransactionRegistration1674238685687 is the last executed migration. It was executed on Fri Jan 20 2023 18:18:05 GMT+0000 (Coordinated Universal Time).
[2023-01-24T17:50:40.498Z]Now reverting it...
[2023-01-24T17:50:40.501Z][QUERY]: BEGIN TRANSACTION
[2023-01-24T17:50:40.757Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_a458c11f312b6b23d68691b50c8"
[2023-01-24T17:50:40.895Z][QUERY]: ALTER TABLE "funding_users_user" DROP CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3"
[2023-01-24T17:50:41.027Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_4e1da5107fc718e03e363633a11"
[2023-01-24T17:50:41.162Z][QUERY]: ALTER TABLE "funding_subjects_subject" DROP CONSTRAINT "FK_eddf9d350e473527bd3b046df2e"
[2023-01-24T17:50:41.295Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_26023533594b6104821aca7dcfb"
[2023-01-24T17:50:41.432Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_5acc35de62f727155b44c5077cc"
[2023-01-24T17:50:41.564Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_67d6038132b6c74844c76541eb6"
[2023-01-24T17:50:41.701Z][QUERY]: ALTER TABLE "user_transaction" DROP CONSTRAINT "FK_1422cc85c1642eed91e947cf877"
[2023-01-24T17:50:41.828Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8"
[2023-01-24T17:50:41.959Z][QUERY]: ALTER TABLE "funding_transaction" DROP CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5"
[2023-01-24T17:50:42.088Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c"
[2023-01-24T17:50:42.242Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_e592cfeded04fe8a928abaa278f"
[2023-01-24T17:50:42.397Z][QUERY]: ALTER TABLE "funding" DROP CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5"
[2023-01-24T17:50:42.537Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69"
[2023-01-24T17:50:42.682Z][QUERY]: ALTER TABLE "student_in_funding" DROP CONSTRAINT "FK_b54d41b45616caa71b38f3d792f"
[2023-01-24T17:50:42.811Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_97e9454fcd0621a03478241d264"
[2023-01-24T17:50:42.947Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077"
[2023-01-24T17:50:43.108Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630"
[2023-01-24T17:50:43.237Z][QUERY]: ALTER TABLE "req_instant" DROP CONSTRAINT "FK_8c8098e310faf4db4165474845e"
[2023-01-24T17:50:43.367Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_d7e16e7104db61867db479e6fa7"
[2023-01-24T17:50:43.500Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_cd8274b3e5c420f57a14e9b6950"
[2023-01-24T17:50:43.633Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_abf5442bda498bff637a09d2d61"
[2023-01-24T17:50:43.769Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_73366372b46c005d3c1e472a3f8"
[2023-01-24T17:50:43.910Z][QUERY]: ALTER TABLE "lesson" DROP CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78"
[2023-01-24T17:50:44.037Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_77b3f1846ed47c723c8525ca223"
[2023-01-24T17:50:44.167Z][QUERY]: ALTER TABLE "status_log" DROP CONSTRAINT "FK_4dc43a103932c17aa9891325e3c"
[2023-01-24T17:50:44.306Z][QUERY]: ALTER TABLE "registration" DROP CONSTRAINT "FK_787e37bb3fc13bb16580a67a3d3"
[2023-01-24T17:50:44.438Z][QUERY]: ALTER TABLE "registration" DROP CONSTRAINT "FK_6c992d9c3648892e1b553fb12ce"
[2023-01-24T17:50:44.573Z][QUERY]: DROP INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user"
[2023-01-24T17:50:44.707Z][QUERY]: DROP INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user"
[2023-01-24T17:50:44.838Z][QUERY]: DROP TABLE "funding_users_user"
[2023-01-24T17:50:44.962Z][QUERY]: DROP INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject"
[2023-01-24T17:50:45.091Z][QUERY]: DROP INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject"
[2023-01-24T17:50:45.228Z][QUERY]: DROP TABLE "funding_subjects_subject"
[2023-01-24T17:50:45.359Z][QUERY]: DROP TABLE "template"
[2023-01-24T17:50:45.488Z][QUERY]: DROP INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction"
[2023-01-24T17:50:45.625Z][QUERY]: DROP INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction"
[2023-01-24T17:50:45.767Z][QUERY]: DROP INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction"
[2023-01-24T17:50:45.897Z][QUERY]: DROP INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction"
[2023-01-24T17:50:46.027Z][QUERY]: DROP TABLE "user_transaction"
[2023-01-24T17:50:46.169Z][QUERY]: DROP INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction"
[2023-01-24T17:50:46.299Z][QUERY]: DROP INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction"
[2023-01-24T17:50:46.433Z][QUERY]: DROP TABLE "funding_transaction"
[2023-01-24T17:50:46.579Z][QUERY]: DROP INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding"
[2023-01-24T17:50:46.720Z][QUERY]: DROP INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding"
[2023-01-24T17:50:46.849Z][QUERY]: DROP INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding"
[2023-01-24T17:50:46.981Z][QUERY]: DROP TABLE "funding"
[2023-01-24T17:50:47.105Z][QUERY]: DROP INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type"
[2023-01-24T17:50:47.229Z][QUERY]: DROP TABLE "funding_type"
[2023-01-24T17:50:47.359Z][QUERY]: DROP INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding"
[2023-01-24T17:50:47.486Z][QUERY]: DROP INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding"
[2023-01-24T17:50:47.616Z][QUERY]: DROP TABLE "student_in_funding"
[2023-01-24T17:50:47.743Z][QUERY]: DROP TABLE "req_instant"
[2023-01-24T17:50:47.867Z][QUERY]: DROP INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson"
[2023-01-24T17:50:48.069Z][QUERY]: DROP INDEX "IDX_d7e16e7104db61867db479e6fa" ON "lesson"
[2023-01-24T17:50:48.197Z][QUERY]: DROP INDEX "IDX_cd8274b3e5c420f57a14e9b695" ON "lesson"
[2023-01-24T17:50:48.344Z][QUERY]: DROP TABLE "lesson"
[2023-01-24T17:50:48.470Z][QUERY]: DROP TABLE "status_log"
[2023-01-24T17:50:48.599Z][QUERY]: DROP INDEX "IDX_787e37bb3fc13bb16580a67a3d" ON "registration"
[2023-01-24T17:50:48.728Z][QUERY]: DROP TABLE "registration"
[2023-01-24T17:50:48.863Z][QUERY]: DELETE FROM "Knektu-develop".."_migrations" WHERE "timestamp" = @0 AND "name" = @1 -- PARAMETERS: [{"value":1674238685687,"type":"bigint","params":[]},{"value":"lessonStatuslogTransactionRegistration1674238685687","type":"varchar","params":[]}]
[2023-01-24T17:50:48.994Z]Migration lessonStatuslogTransactionRegistration1674238685687 has been reverted successfully.
[2023-01-24T17:50:49.121Z][QUERY]: COMMIT
[2023-01-24T17:51:36.376Z][QUERY]: SELECT SCHEMA_NAME() AS "schema_name"
[2023-01-24T17:51:42.437Z][QUERY]: SELECT * FROM "Knektu-develop"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = '_migrations' AND "TABLE_SCHEMA" = 'dbo'
[2023-01-24T17:51:42.735Z][QUERY]: SELECT * FROM "Knektu-develop".."_migrations" "_migrations" ORDER BY "id" DESC
[2023-01-24T17:51:42.996Z]3 migrations are already loaded in the database.
[2023-01-24T17:51:42.996Z]4 migrations were found in the source code.
[2023-01-24T17:51:42.997Z]addNotification1669986806604 is the last executed migration. It was executed on Fri Dec 02 2022 13:13:26 GMT+0000 (Coordinated Universal Time).
[2023-01-24T17:51:42.997Z]1 migrations are new migrations must be executed.
[2023-01-24T17:51:42.998Z][QUERY]: BEGIN TRANSACTION
[2023-01-24T17:51:43.235Z][QUERY]: CREATE TABLE "registration" ("id" int NOT NULL IDENTITY(1,1), "status" int CONSTRAINT CHK_96316c742ce2bd66353ab7b07d_ENUM CHECK(status IN ('1000','1001','1002','1003','1004','1005','1006','1007','1008','1009')) NOT NULL CONSTRAINT "DF_fecec899bc9d9ae757d4ebe8dd8" DEFAULT 1000, "studentId" int NOT NULL, "lessonId" int NOT NULL, "studentUserId" int NOT NULL, "agoraToken" nvarchar(255), "isMute" bit NOT NULL CONSTRAINT "DF_39da412b409076e680ef973080c" DEFAULT 1, "joinedAt" datetime, "isBlocked" bit NOT NULL CONSTRAINT "DF_a16afc47693be8131c077db3b05" DEFAULT 0, "prepaidCost" decimal(10,4) NOT NULL, "realCost" decimal(10,4), "createdAt" datetime2 NOT NULL CONSTRAINT "DF_011f469e9cded90d8fdd26e0e50" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_6f92f5257e587881ec2e66be08f" DEFAULT getUTCDate(), CONSTRAINT "PK_a1c83caeace68f354c801807577" PRIMARY KEY ("id", "lessonId"))
[2023-01-24T17:51:43.382Z][QUERY]: CREATE INDEX "IDX_787e37bb3fc13bb16580a67a3d" ON "registration" ("lessonId") 
[2023-01-24T17:51:43.507Z][QUERY]: CREATE TABLE "status_log" ("id" int NOT NULL IDENTITY(1,1), "userId" int NOT NULL, "requestInstantId" int, "lessonId" int, "fromState" int, "toState" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_888adcf2d7e38d0696d05d0c18d" DEFAULT getUTCDate(), CONSTRAINT "PK_47ac65ae41fa92422ea43f903bf" PRIMARY KEY ("id"))
[2023-01-24T17:51:43.643Z][QUERY]: CREATE TABLE "review" ("id" int NOT NULL IDENTITY(1,1), "studentId" int NOT NULL, "studentUserId" int NOT NULL, "tutorId" int NOT NULL, "tutorUserId" int NOT NULL, "lessonId" int NOT NULL, "comment" nvarchar(255) NOT NULL, "stars" int NOT NULL, "isRemoved" bit NOT NULL CONSTRAINT "DF_934bf14579a43265a9a34bf49c4" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_34968765df5f6f3946c2e4573a7" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_b5048343dfc8ccdafd5ef470e4b" DEFAULT getUTCDate(), CONSTRAINT "PK_2e4299a343a81574217255c00ca" PRIMARY KEY ("id"))
[2023-01-24T17:51:43.778Z][QUERY]: CREATE TABLE "lesson" ("id" int NOT NULL IDENTITY(1,1), "reqInstantId" int NOT NULL, "lessonType" int NOT NULL, "lessonTime" int NOT NULL, "description" nvarchar(255), "capacity" int NOT NULL CONSTRAINT "DF_5f015a2e4016456cab65e55e101" DEFAULT 1, "availability" int NOT NULL CONSTRAINT "DF_57e38caa67fc4dc463c4c1d75af" DEFAULT 0, "realStartedAt" datetime, "realFinishedAt" datetime, "scheduleStartedAt" datetime, "scheduleFinishedAt" datetime, "channelGUID" uniqueidentifier NOT NULL CONSTRAINT "DF_303f1fb6efe9f8fc384916c3fb7" DEFAULT NEWSEQUENTIALID(), "tutorId" int NOT NULL, "tutorUserId" int NOT NULL, "tutorLastOnline" datetime, "tutorAgoraToken" nvarchar(255) NOT NULL, "status" int NOT NULL CONSTRAINT "DF_3ef2a439f5706d7b4542ef8d6d9" DEFAULT 100, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_1d55fab5743742a0e44539eda85" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_067ce43988dc331fcd645efb777" DEFAULT getUTCDate(), "subjectId" int, "keyStageLevelId" int, CONSTRAINT "UQ_303f1fb6efe9f8fc384916c3fb7" UNIQUE ("channelGUID"), CONSTRAINT "PK_0ef25918f0237e68696dee455bd" PRIMARY KEY ("id"))
[2023-01-24T17:51:43.923Z][QUERY]: CREATE INDEX "IDX_cd8274b3e5c420f57a14e9b695" ON "lesson" ("subjectId") 
[2023-01-24T17:51:44.061Z][QUERY]: CREATE INDEX "IDX_d7e16e7104db61867db479e6fa" ON "lesson" ("keyStageLevelId") 
[2023-01-24T17:51:44.196Z][QUERY]: CREATE UNIQUE INDEX "REL_1b8bc8c36b5ff5a308f99e0af7" ON "lesson" ("reqInstantId") WHERE "reqInstantId" IS NOT NULL
[2023-01-24T17:51:44.345Z][QUERY]: CREATE TABLE "req_instant" ("id" int NOT NULL IDENTITY(1,1), "keyStageLevelId" int NOT NULL, "subjectId" int NOT NULL, "description" nvarchar(255), "duration" int NOT NULL, "status" int NOT NULL CONSTRAINT "DF_2af9af0405132ee54a51b387171" DEFAULT 10, "cost" int NOT NULL, "studentId" int NOT NULL, "studentUserId" int NOT NULL, "tutorId" int NOT NULL, "tutorUserId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_10478adf2b6bdddeff5cc816e63" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_429fca86fb8c2a406ea6acb7fa5" DEFAULT getUTCDate(), "finishedAt" datetime, "holdingAt" datetime, CONSTRAINT "PK_0df0c7f86cd18ce417bcb764eab" PRIMARY KEY ("id"))
[2023-01-24T17:51:44.489Z][QUERY]: CREATE TABLE "student_in_funding" ("id" int NOT NULL IDENTITY(1,1), "studentId" int NOT NULL, "fundingId" int NOT NULL, "fundingAssigned" decimal(10,4) NOT NULL CONSTRAINT "DF_202265c09faad6ca0e62c05469a" DEFAULT 0, "fundingRemaining" decimal(10,4) NOT NULL CONSTRAINT "DF_8ffc82b9c4e37f4a511b5f47768" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_8ef4ab58fcadbf3c177d30d74cf" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_e23311139a698b3aad8151193e7" DEFAULT getUTCDate(), CONSTRAINT "PK_04a4ac0ca59cd474332d503e834" PRIMARY KEY ("id", "studentId", "fundingId"))
[2023-01-24T17:51:44.802Z][QUERY]: CREATE INDEX "IDX_b54d41b45616caa71b38f3d792" ON "student_in_funding" ("studentId") 
[2023-01-24T17:51:45.000Z][QUERY]: CREATE INDEX "IDX_a461a7a9a2fcf47a10f374d1b6" ON "student_in_funding" ("fundingId") 
[2023-01-24T17:51:45.133Z][QUERY]: CREATE TABLE "funding_type" ("id" int NOT NULL IDENTITY(1,1), "title" nvarchar(255) NOT NULL, CONSTRAINT "PK_9186aa2de0fecacc4270a171c72" PRIMARY KEY ("id"))
[2023-01-24T17:51:45.266Z][QUERY]: CREATE INDEX "IDX_b286d916a40e83cdfc0ed20d62" ON "funding_type" ("title") 
[2023-01-24T17:51:45.395Z][QUERY]: CREATE TABLE "funding" ("id" int NOT NULL IDENTITY(1,1), "stripeCustomerId" nvarchar(255), "numberOfAddedStudents" int NOT NULL CONSTRAINT "DF_c57e74a7c5b3317c9799737bb17" DEFAULT 0, "numberOfPendingStudents" int NOT NULL CONSTRAINT "DF_176c802cc15918cdca01f1b548b" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_652c617d0df737524e3822a4327" DEFAULT getUTCDate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_3208742513b8eeff356f9f43605" DEFAULT getUTCDate(), "fundingTypeId" int, "fundingOwnerUserId" int NOT NULL, "schoolId" int NOT NULL, CONSTRAINT "PK_096afc0d11a08deb52da61f039e" PRIMARY KEY ("id"))
[2023-01-24T17:51:45.534Z][QUERY]: CREATE INDEX "IDX_47ab261ae9813f8d094fec7c4e" ON "funding" ("fundingTypeId") 
[2023-01-24T17:51:45.666Z][QUERY]: CREATE INDEX "IDX_e592cfeded04fe8a928abaa278" ON "funding" ("fundingOwnerUserId") 
[2023-01-24T17:51:45.793Z][QUERY]: CREATE INDEX "IDX_033ecfe99ddee518062ed2dad4" ON "funding" ("schoolId") 
[2023-01-24T17:51:45.919Z][QUERY]: CREATE TABLE "funding_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_fd623e7139f320060ebd9e8202f" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_2c3637c858eb677b8f925aefd2_ENUM CHECK(type IN ('FUNDING_TOPUP','ASSIGN_FUND')) NOT NULL, "schoolId" int NOT NULL, "fundingId" int NOT NULL, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_2524a1448f39955d3c01f38a328" DEFAULT getUTCDate(), CONSTRAINT "PK_7b3e2baa3c95e783431e97bb75f" PRIMARY KEY ("id"))
[2023-01-24T17:51:46.049Z][QUERY]: CREATE INDEX "IDX_c90ef60549af016fd48d25d5ef" ON "funding_transaction" ("schoolId") 
[2023-01-24T17:51:46.183Z][QUERY]: CREATE INDEX "IDX_e38721c88ce1f75ab78020dfac" ON "funding_transaction" ("fundingId") 
[2023-01-24T17:51:46.319Z][QUERY]: CREATE TABLE "user_transaction" ("id" int NOT NULL IDENTITY(1,1), "amount" decimal(10,4) NOT NULL CONSTRAINT "DF_699ffce82f12a9f11d46796da48" DEFAULT 0, "type" nvarchar(255) CONSTRAINT CHK_760b65a581ec67dffeb38bb109_ENUM CHECK(type IN ('STUDENT_SELF_FUNDING_TOPUP','STUDENT_LESSON_FEE_PAY_SELF_FUNDING','STUDENT_LESSON_FEE_BACK_SELF_FUNDING','STUDENT_FUNDING_ASSIGN_FUND','STUDENT_LESSON_FEE_PAY_FUNDING','STUDENT_LESSON_FEE_BACK_FUNDING','PARENT_STUDENT_SELF_FUNDING_TOPUP','TUTOR_LESSON_EARN','TUTOR_WITHDRAW','SYSTEM_LESSON_SHARE')) NOT NULL, "userId" int NOT NULL, "lessonId" int, "fundingId" int, "studentUserId" int, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_70b2bdb02c290be0ec5ccf76bac" DEFAULT getUTCDate(), CONSTRAINT "PK_e36b77a5263ac0f191277c4c5d2" PRIMARY KEY ("id"))
[2023-01-24T17:51:46.451Z][QUERY]: CREATE INDEX "IDX_1422cc85c1642eed91e947cf87" ON "user_transaction" ("userId") 
[2023-01-24T17:51:46.583Z][QUERY]: CREATE INDEX "IDX_67d6038132b6c74844c76541eb" ON "user_transaction" ("lessonId") 
[2023-01-24T17:51:46.707Z][QUERY]: CREATE INDEX "IDX_5acc35de62f727155b44c5077c" ON "user_transaction" ("fundingId") 
[2023-01-24T17:51:46.839Z][QUERY]: CREATE INDEX "IDX_26023533594b6104821aca7dcf" ON "user_transaction" ("studentUserId") 
[2023-01-24T17:51:46.968Z][QUERY]: CREATE TABLE "template" ("id" int NOT NULL IDENTITY(1,1), "name" varchar(120) NOT NULL, "email" varchar(120) NOT NULL, "isDeleted" bit NOT NULL CONSTRAINT "DF_174bbdfda9fae5387e6c897149e" DEFAULT 0, "createdAt" datetime2 NOT NULL CONSTRAINT "DF_322f2f29140f26d5dfb6670da36" DEFAULT getdate(), "updatedAt" datetime2 NOT NULL CONSTRAINT "DF_89f7cc3b4eb4f532e24b5456fbb" DEFAULT getdate(), CONSTRAINT "PK_fbae2ac36bd9b5e1e793b957b7f" PRIMARY KEY ("id"))
[2023-01-24T17:51:47.112Z][QUERY]: CREATE TABLE "funding_subjects_subject" ("fundingId" int NOT NULL, "subjectId" int NOT NULL, CONSTRAINT "PK_8ae7f8516810676bbbf751af142" PRIMARY KEY ("fundingId", "subjectId"))
[2023-01-24T17:51:47.239Z][QUERY]: CREATE INDEX "IDX_eddf9d350e473527bd3b046df2" ON "funding_subjects_subject" ("fundingId") 
[2023-01-24T17:51:47.363Z][QUERY]: CREATE INDEX "IDX_4e1da5107fc718e03e363633a1" ON "funding_subjects_subject" ("subjectId") 
[2023-01-24T17:51:47.486Z][QUERY]: CREATE TABLE "funding_users_user" ("fundingId" int NOT NULL, "userId" int NOT NULL, CONSTRAINT "PK_053ff2d5afb36e09b07caed95b1" PRIMARY KEY ("fundingId", "userId"))
[2023-01-24T17:51:47.615Z][QUERY]: CREATE INDEX "IDX_991175e6681aa3e0aa3dad6a7e" ON "funding_users_user" ("fundingId") 
[2023-01-24T17:51:47.745Z][QUERY]: CREATE INDEX "IDX_a458c11f312b6b23d68691b50c" ON "funding_users_user" ("userId") 
[2023-01-24T17:51:47.876Z][QUERY]: ALTER TABLE "registration" ADD CONSTRAINT "FK_6c992d9c3648892e1b553fb12ce" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:48.012Z][QUERY]: ALTER TABLE "registration" ADD CONSTRAINT "FK_787e37bb3fc13bb16580a67a3d3" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE CASCADE ON UPDATE NO ACTION
[2023-01-24T17:51:48.139Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_4dc43a103932c17aa9891325e3c" FOREIGN KEY ("requestInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:48.270Z][QUERY]: ALTER TABLE "status_log" ADD CONSTRAINT "FK_77b3f1846ed47c723c8525ca223" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:48.402Z][QUERY]: ALTER TABLE "review" ADD CONSTRAINT "FK_88abd13b683a17c1ff613a7846d" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:48.536Z][QUERY]: ALTER TABLE "review" ADD CONSTRAINT "FK_8dc9c3a13e1e099d799ad593b40" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:48.668Z][QUERY]: ALTER TABLE "review" ADD CONSTRAINT "FK_2c37ce20c032f7128487b9318e7" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:48.808Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_1b8bc8c36b5ff5a308f99e0af78" FOREIGN KEY ("reqInstantId") REFERENCES "req_instant"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:48.938Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_73366372b46c005d3c1e472a3f8" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:49.064Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_abf5442bda498bff637a09d2d61" FOREIGN KEY ("tutorUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:49.188Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_cd8274b3e5c420f57a14e9b6950" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:49.312Z][QUERY]: ALTER TABLE "lesson" ADD CONSTRAINT "FK_d7e16e7104db61867db479e6fa7" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:49.454Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_8c8098e310faf4db4165474845e" FOREIGN KEY ("keyStageLevelId") REFERENCES "key_stage_level"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:49.587Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_e05c29dc9cb19375a9c18a67630" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:49.722Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_547d7e5f9aa0855ec29b64bb077" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:49.856Z][QUERY]: ALTER TABLE "req_instant" ADD CONSTRAINT "FK_97e9454fcd0621a03478241d264" FOREIGN KEY ("tutorId") REFERENCES "tutor"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:50.015Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_b54d41b45616caa71b38f3d792f" FOREIGN KEY ("studentId") REFERENCES "student"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:50.141Z][QUERY]: ALTER TABLE "student_in_funding" ADD CONSTRAINT "FK_a461a7a9a2fcf47a10f374d1b69" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE NO ACTION
[2023-01-24T17:51:50.275Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_47ab261ae9813f8d094fec7c4e5" FOREIGN KEY ("fundingTypeId") REFERENCES "funding_type"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:50.410Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_e592cfeded04fe8a928abaa278f" FOREIGN KEY ("fundingOwnerUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:50.552Z][QUERY]: ALTER TABLE "funding" ADD CONSTRAINT "FK_033ecfe99ddee518062ed2dad4c" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:50.704Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_c90ef60549af016fd48d25d5ef5" FOREIGN KEY ("schoolId") REFERENCES "school"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:50.836Z][QUERY]: ALTER TABLE "funding_transaction" ADD CONSTRAINT "FK_e38721c88ce1f75ab78020dfac8" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:50.971Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_1422cc85c1642eed91e947cf877" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:51.103Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_67d6038132b6c74844c76541eb6" FOREIGN KEY ("lessonId") REFERENCES "lesson"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:51.245Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_5acc35de62f727155b44c5077cc" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:51.374Z][QUERY]: ALTER TABLE "user_transaction" ADD CONSTRAINT "FK_26023533594b6104821aca7dcfb" FOREIGN KEY ("studentUserId") REFERENCES "user"("id") ON DELETE NO ACTION ON UPDATE NO ACTION
[2023-01-24T17:51:51.506Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_eddf9d350e473527bd3b046df2e" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-24T17:51:51.635Z][QUERY]: ALTER TABLE "funding_subjects_subject" ADD CONSTRAINT "FK_4e1da5107fc718e03e363633a11" FOREIGN KEY ("subjectId") REFERENCES "subject"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-24T17:51:51.774Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_991175e6681aa3e0aa3dad6a7e3" FOREIGN KEY ("fundingId") REFERENCES "funding"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-24T17:51:51.905Z][QUERY]: ALTER TABLE "funding_users_user" ADD CONSTRAINT "FK_a458c11f312b6b23d68691b50c8" FOREIGN KEY ("userId") REFERENCES "user"("id") ON DELETE CASCADE ON UPDATE CASCADE
[2023-01-24T17:51:52.047Z][QUERY]: INSERT INTO "Knektu-develop".."_migrations"("timestamp", "name") VALUES (@0, @1) -- PARAMETERS: [{"value":1674582666705,"type":"bigint","params":[]},{"value":"lessonStatuslogTransactionRegistration1674582666705","type":"varchar","params":[]}]
[2023-01-24T17:51:52.185Z]Migration lessonStatuslogTransactionRegistration1674582666705 has been executed successfully.
[2023-01-24T17:51:52.314Z][QUERY]: COMMIT
